<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">
<meta name="description" content="Swift POS System for inventory and sales management">
<title>Swift POS - Internal System</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').catch(function(err){
      console.error('Service worker registration failed:', err);
    });
  });
}
</script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Helvetica:wght@400;500;600;700&display=swap');

body {
font-family: 'Helvetica', 'Inter', sans-serif;
background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
min-height: 100vh;
margin: 0;
padding: 0;
}

.myanmar-font {
font-family: 'Noto Sans Myanmar', sans-serif;
}

.active-tab {
background-color: #4f46e5;
color: white;
}

.product-card:hover {
transform: translateY(-3px);
box-shadow: 0 10px 15px 3px rgba(0, 0, 0, 0.1);
}

.custom-scrollbar::-webkit-scrollbar {
width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
background: #f1f1f1;
border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
background: #c5c5c5;
border-radius: 10px;
}

.receipt-card {
border: 2px dashed #9ca3af;
border-radius: 0.5rem;
padding: 1rem;
background-color: #f9fafb;
}

@media print {
body * {
visibility: hidden;
}
.receipt,
.receipt * {
visibility: visible;
}
.receipt {
position: absolute;
left: 0;
top: 0;
width: 80mm;
padding: 1rem;
}
.no-print {
display: none !important;
}
}

/* Mobile Responsive Navigation */
.mobile-nav {
display: none;
}

@media (max-width: 768px) {
.mobile-nav {
display: block;
}
.desktop-nav {
display: none;
}
.main-content {
padding-top: 0;
}
.sidebar {
position: fixed;
left: -250px;
top: 0;
height: 100%;
width: 250px;
background: white;
z-index: 1000;
transition: left 0.3s ease;
box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}
.sidebar.open {
left: 0;
}
.overlay {
display: none;
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.5);
z-index: 999;
}
.overlay.open {
display: block;
}
.menu-button {
display: block;
position: fixed;
top: 10px;
left: 10px;
z-index: 1001;
background: #4f46e5;
color: white;
border: none;
border-radius: 50%;
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
}
}

/* Accessibility improvements */
.skip-link {
position: absolute;
top: -40px;
left: 6px;
background: #4f46e5;
color: white;
padding: 8px;
z-index: 100;
transition: top 0.3s;
}

.skip-link:focus {
top: 6px;
}

/* Focus styles for keyboard navigation */
button:focus,
input:focus,
select:focus,
textarea:focus {
outline: 3px solid #4f46e5;
outline-offset: 2px;
}

/* Company header styling */
.company-header {
background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
color: white;
padding: 1rem;
border-radius: 0.5rem;
margin-bottom: 1.5rem;
display: flex;
align-items: center;
justify-content: space-between;
}

.company-info {
display: flex;
align-items: center;
gap: 1rem;
}

.company-logo {
width: 60px;
height: 60px;
border-radius: 8px;
object-fit: contain;
background: white;
padding: 4px;
}

.company-name {
font-size: 1.5rem;
font-weight: bold;
}

/* Improved responsive design */
@media (max-width: 640px) {
.company-header {
flex-direction: column;
text-align: center;
gap: 0.5rem;
}
.company-info {
flex-direction: column;
}
.btn-mobile {
padding: 12px;
min-height: 44px;
min-width: 44px;
}
}

/* Status indicator for offline/online mode */
.status-indicator {
display: inline-block;
width: 10px;
height: 10px;
border-radius: 50%;
margin-right: 5px;
}

.status-online {
background-color: #10b981;
}

.status-offline {
background-color: #ef4444;
}

/* Expense category styling */
.expense-category {
border-left: 4px solid #4f46e5;
padding-left: 1rem;
margin-bottom: 1.5rem;
}

.category-header {
font-weight: 600;
color: #374151;
margin-bottom: 0.5rem;
}
</style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-start p-0 min-h-screen">
<!-- Skip link for keyboard users -->
<a href="#main-content" class="skip-link">Skip to main content</a>

<!-- Mobile menu button -->
<button class="menu-button md:hidden" id="mobileMenuButton" aria-label="Open menu">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
</svg>
</button>

<!-- Overlay for mobile menu -->
<div class="overlay" id="overlay"></div>

<!-- Sidebar for mobile -->
<div class="sidebar md:hidden" id="sidebar">
<div class="p-4 border-b">
<div class="flex justify-between items-center">
<h2 class="text-lg font-semibold">Menu</h2>
<button id="closeSidebar" aria-label="Close menu">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
</svg>
</button>
</div>
</div>
<nav class="p-4">
<button id="mobileDashboardTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M3 13.5a9.5 9.5 0 0115.3-7.5l-3.2 3.2m-12 0l3.2-3.2m-3.2 3.2a9.5 9.5 0 0115.3 7.5l-3.2-3.2M7.2 12.8a.8.8 0 100-1.6.8.8 0 000 1.6z" />
</svg>
Dashboard
</button>
<button id="mobileProductsTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
</svg>
Products
</button>
<button id="mobileSalesTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5h.007m-7.5 0h.007m7.5 0a.75.75 0 110 1.5.75.75 0 010-1.5zM12 12.75a.75.75 0 110 1.5.75.75 0 010-1.5zM4.5 18a.75.75 0 110 1.5.75.75 0 010-1.5z" />
</svg>
Sales
</button>
<button id="mobileSuppliersTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m18-6H3l9-9m0 18v-12" />
</svg>
Suppliers
</button>
<button id="mobileExpensesTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
Expenses
</button>
<button id="mobileCustomersTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M15 9h-2.25a.75.75 0 000 1.5H15V9z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9h2.25a.75.75 0 000 1.5H8.25V9z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15h2.25a.75.75 0 000 1.5H8.25V15z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M12.75 15h2.25a.75.75 0 000 1.5H12.75V15z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21L15 15" />
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21h-6v-6" />
</svg>
Customers
</button>
<button id="mobileReportsTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M10 20.5v-10h4v10M10 14.5v-4h4v4M10 18.5v-4h4v4" />
</svg>
Reports
</button>
<button id="mobileSettingsTab" class="w-full text-left py-2 px-4 rounded-lg mb-2 flex items-center">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 6a6 6 0 100 12 6 6 0 000-12z" />
</svg>
Settings
</button>
</nav>
</div>

<!-- Top Navigation Bar (Mobile & Desktop) -->
<header class="w-full bg-white shadow-lg z-10">
<!-- Desktop Navigation -->
<nav class="desktop-nav flex justify-center space-x-1 p-2" aria-label="Main navigation">
<button id="dashboardTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200 active-tab" aria-current="page">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M3 13.5a9.5 9.5 0 0115.3-7.5l-3.2 3.2m-12 0l3.2-3.2m-3.2 3.2a9.5 9.5 0 0115.3 7.5l-3.2-3.2M7.2 12.8a.8.8 0 100-1.6.8.8 0 000 1.6z" />
</svg>
Dashboard
</button>
<button id="productsTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
</svg>
Products
</button>
<button id="salesTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5h.007m-7.5 0h.007m7.5 0a.75.75 0 110 1.5.75.75 0 010-1.5zM12 12.75a.75.75 0 110 1.5.75.75 0 010-1.5zM4.5 18a.75.75 0 110 1.5.75.75 0 010-1.5z" />
</svg>
Sales
</button>
<button id="suppliersTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m18-6H3l9-9m0 18v-12" />
</svg>
Suppliers
</button>
<button id="expensesTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
Expenses
</button>
<button id="customersTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M15 9h-2.25a.75.75 0 000 1.5H15V9z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9h2.25a.75.75 0 000 1.5H8.25V9z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15h2.25a.75.75 0 000 1.5H8.25V15z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M12.75 15h2.25a.75.75 0 000 1.5H12.75V15z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21L15 15" />
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21h-6v-6" />
</svg>
Customers
</button>
<button id="reportsTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M10 20.5v-10h4v10M10 14.5v-4h4v4M10 18.5v-4h4v4" />
</svg>
Reports
</button>
<button id="settingsTab" class="flex items-center px-4 py-3 text-sm font-medium rounded-t-lg hover:bg-gray-200 transition-colors duration-200">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 6a6 6 0 100 12 6 6 0 000-12z" />
</svg>
Settings
</button>
</nav>

<!-- Mobile Navigation -->
<div class="mobile-nav md:hidden bg-gray-50 p-2">
<label for="mobileNavSelect" class="sr-only">Select a section</label>
<select id="mobileNavSelect" class="w-full p-3 text-sm font-medium border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="Mobile navigation">
<option value="dashboard">Dashboard</option>
<option value="products">Products</option>
<option value="sales">Sales</option>
<option value="suppliers">Suppliers</option>
<option value="expenses">Expenses</option>
<option value="customers">Customers</option>
<option value="reports">Reports</option>
<option value="settings">Settings</option>
</select>
</div>
</header>

<!-- Connection Status Indicator -->
<div class="w-full bg-yellow-100 text-yellow-800 py-2 px-4 text-center hidden" id="offlineIndicator">
<span class="status-indicator status-offline"></span>
<span id="offlineMessage">You are currently offline. Changes will be synced when connection is restored.</span>
</div>

<!-- Main Content Area -->
<main id="main-content" class="main-content flex-grow w-full max-w-7xl mx-auto bg-gray-50 p-4 md:p-6 shadow-inner relative overflow-y-auto">
<!-- Dashboard View -->
<div id="dashboardView" class="view" aria-labelledby="dashboard-heading">
<!-- Company Header -->
<div class="company-header">
<div class="company-info">
<img id="dashboardCompanyLogo" class="company-logo" src="" alt="Company Logo">
<h1 id="dashboardCompanyName" class="company-name">Swift POS</h1>
</div>
<div class="current-date" id="currentDate"></div>
</div>

<h2 id="dashboard-heading" class="text-3xl font-bold text-gray-900 mb-6">Dashboard</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
<div class="bg-white rounded-lg p-6 shadow-md transition-all duration-300 transform hover:scale-105">
<h3 class="text-sm font-medium text-gray-500">Total Sales</h3>
<p class="text-3xl font-bold text-gray-900 mt-2" id="totalSales">0 MMK</p>
</div>
<div class="bg-white rounded-lg p-6 shadow-md transition-all duration-300 transform hover:scale-105">
<h3 class="text-sm font-medium text-gray-500">Total Profit</h3>
<p class="text-3xl font-bold text-gray-900 mt-2" id="totalProfit">0 MMK</p>
</div>
<div class="bg-white rounded-lg p-6 shadow-md transition-all duration-300 transform hover:scale-105">
<h3 class="text-sm font-medium text-gray-500">Total Products</h3>
<p class="text-3xl font-bold text-gray-900 mt-2" id="totalProducts">0</p>
</div>
<div class="bg-white rounded-lg p-6 shadow-md transition-all duration-300 transform hover:scale-105">
<h3 class="text-sm font-medium text-gray-500">Credit Payments</h3>
<p class="text-3xl font-bold text-red-500 mt-2" id="totalCreditPayments">0 MMK</p>
</div>
</div>
<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Sales Trends (Last 7 Days)</h3>
<canvas id="salesChart" aria-label="Sales trends chart for the last 7 days" role="img"></canvas>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Profit</h3>
<canvas id="monthlyProfitChart" aria-label="Monthly profit chart" role="img"></canvas>
</div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Top 5 Best-Selling Products</h3>
<canvas id="bestSellingProductsChart" aria-label="Top 5 best-selling products chart" role="img"></canvas>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Sales by Category</h3>
<canvas id="salesByCategoryChart" aria-label="Sales by category chart" role="img"></canvas>
</div>
</div>
<!-- Additional Analytics Section -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
<!-- Top 10 Selling Items -->
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Top 10 Selling Items</h3>
<div id="topSellingItems" class="space-y-2">
<!-- Top selling items will be rendered here -->
<p class="text-gray-500 text-center">No sales data available</p>
</div>
</div>

<!-- Low Stock Items -->
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Low Stock Items</h3>
<div id="lowStockItems" class="space-y-2">
<!-- Low stock items will be rendered here -->
<p class="text-gray-500 text-center">No low stock items</p>
</div>
</div>

<!-- Least Selling Items -->
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Least Selling Items</h3>
<div id="leastSellingItems" class="space-y-2">
<!-- Least selling items will be rendered here -->
<p class="text-gray-500 text-center">No sales data available</p>
</div>
</div>
</div>
<!-- Supplier Payments Section -->
<div class="bg-white rounded-lg p-6 shadow-md mt-6">
<h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Supplier Payments</h3>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
</tr>
</thead>
<tbody id="supplierPaymentsDashboard">
<!-- Supplier payments will be rendered here -->
<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No recent payments</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- Products View -->
<div id="productsView" class="view hidden" aria-labelledby="products-heading">
<h2 id="products-heading" class="text-3xl font-bold text-gray-900 mb-6">Product Management</h2>
<div class="bg-white rounded-lg p-6 shadow-md mb-6">
<form id="productForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<input type="hidden" id="productId">
<div class="flex flex-col">
<label for="productName" class="text-sm font-medium text-gray-700 mb-1">Product Name</label>
<input type="text" id="productName" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="productImage" class="text-sm font-medium text-gray-700 mb-1">Product Image</label>
<input type="file" id="productImage" accept="image/*" class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
		<label for="productCategory" class="text-sm font-medium text-gray-700 mb-1">Category</label>
		<div class="flex gap-2">
			<select id="productCategory" required class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
				<option value="">Select Category</option>
			</select>
			<input type="text" id="newCategoryInput" placeholder="New category" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
			<button type="button" id="addCategoryButton" class="bg-indigo-600 text-white px-4 rounded-lg">Add</button>
		</div>
</div>
<div class="flex flex-col">
<label for="productStock" class="text-sm font-medium text-gray-700 mb-1">Stock</label>
<input type="number" id="productStock" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="productBuyingPrice" class="text-sm font-medium text-gray-700 mb-1">Buying Price (MMK)</label>
<input type="number" id="productBuyingPrice" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="productSellingPrice" class="text-sm font-medium text-gray-700 mb-1">Selling Price (MMK)</label>
<input type="number" id="productSellingPrice" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="productSize" class="text-sm font-medium text-gray-700 mb-1">Size</label>
<input type="text" id="productSize" placeholder="e.g., S, M, L or 38" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="productColor" class="text-sm font-medium text-gray-700 mb-1">Color</label>
<input type="text" id="productColor" placeholder="e.g., Red" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="productSupplier" class="text-sm font-medium text-gray-700 mb-1">Supplier</label>
<select id="productSupplier" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<option value="">Select a supplier</option>
</select>
</div>
<div class="flex flex-col">
<label for="productBarcode" class="text-sm font-medium text-gray-700 mb-1">Barcode</label>
<input type="text" id="productBarcode" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex items-end col-span-1 md:col-span-2 lg:col-span-3 space-x-4">
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Product</button>
<button type="button" id="productClearBtn" class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-200">Clear Form</button>
</div>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-4 md:space-y-0">
<h3 class="text-xl font-semibold text-gray-800">Product List</h3>
<div class="flex space-x-2 w-full md:w-auto">
<label for="productSearch" class="sr-only">Search products</label>
<input type="text" id="productSearch" placeholder="Search products..." class="w-full md:w-64 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<button id="productSearchButton" class="bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition-colors duration-200" aria-label="Search products">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
</svg>
</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Buying Price</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Selling Price</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
</tr>
</thead>
<tbody id="productList" class="bg-white divide-y divide-gray-200">
<!-- Product list will be rendered here -->
<tr><td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No products added yet</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- Sales View -->
<div id="salesView" class="view hidden" aria-labelledby="sales-heading">
<h2 id="sales-heading" class="text-3xl font-bold text-gray-900 mb-6">Sales</h2>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="lg:col-span-2">
<div class="bg-white rounded-lg p-6 shadow-md mb-6">
		<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
<div class="flex flex-col">
<label for="customerSelect" class="text-sm font-medium text-gray-700 mb-1">Customer</label>
<select id="customerSelect" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<option value="walk-in">Walk-in Customer</option>
<option value="online">Online Customer</option>
<!-- Customer options will be populated here -->
</select>
</div>
			<div class="flex flex-col">
				<label for="salesSearch" class="text-sm font-medium text-gray-700 mb-1">Search</label>
				<input type="text" id="salesSearch" placeholder="Search products..." class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
			</div>
</div>
		<div class="flex items-center gap-4">
			<div class="flex-1">
				<label class="text-sm font-medium text-gray-700 mb-1">Categories</label>
				<div id="salesCategoryChips" class="flex flex-wrap gap-2"></div>
			</div>
			<div class="flex-1">
				<label for="discountInput" class="text-sm font-medium text-gray-700 mb-1">Discount (%)</label>
				<input type="number" id="discountInput" min="0" max="100" value="0" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
			</div>
		</div>
</div>
	<div class="bg-white rounded-lg p-6 shadow-md">
		<h3 class="text-xl font-semibold text-gray-800 mb-4">Products</h3>
		<div id="salesProductGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
			<!-- Product cards rendered here -->
			<p class="text-gray-500 col-span-full text-center">No products</p>
		</div>
		<h3 class="text-xl font-semibold text-gray-800 mb-4">Current Sale</h3>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
</tr>
</thead>
<tbody id="cartItems">
<!-- Cart items will be rendered here -->
<tr><td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No items in cart</td></tr>
</tbody>
</table>
</div>
<div class="flex justify-between items-center mt-4">
<div class="text-lg font-semibold text-gray-800">Total: <span id="cartTotal">0</span> MMK</div>
<button id="clearCartButton" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 transition-colors duration-200">Clear Cart</button>
</div>
</div>
</div>
<div class="lg:col-span-1">
<div class="bg-white rounded-lg p-6 shadow-md mb-6 receipt-card">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Receipt</h3>
<div id="receiptContent" class="receipt">
<div class="text-center mb-4">
<h4 class="font-bold text-lg" id="receiptCompanyName">Swift POS</h4>
<p class="text-sm" id="receiptDate"></p>
</div>
<div class="border-t border-b py-2 mb-4">
<div id="receiptItems">
<!-- Receipt items will be rendered here -->
<p class="text-center text-gray-500">No items</p>
</div>
</div>
<div class="flex justify-between font-semibold mb-2">
<span>Total:</span>
<span id="receiptTotal">0 MMK</span>
</div>
<div class="flex justify-between mb-2">
<span>Paid:</span>
<span id="receiptPaid">0 MMK</span>
</div>
<div class="flex justify-between font-semibold border-t pt-2">
<span>Change:</span>
<span id="receiptChange">0 MMK</span>
</div>
</div>
</div>

<div class="bg-white rounded-lg p-6 shadow-md mb-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Payment</h3>
<div class="space-y-4">
			<div class="flex flex-col">
				<label for="orderDiscount" class="text-sm font-medium text-gray-700 mb-1">Order Discount (%)</label>
				<input type="number" id="orderDiscount" min="0" max="100" value="0" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
			</div>
<div class="flex flex-col">
<label for="paymentMethod" class="text-sm font-medium text-gray-700 mb-1">Payment Method</label>
<select id="paymentMethod" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<option value="cash">Cash</option>
<option value="card">Card</option>
<option value="transfer">Bank Transfer</option>
</select>
</div>
<div class="flex flex-col">
<label for="amountPaid" class="text-sm font-medium text-gray-700 mb-1">Amount Paid (MMK)</label>
<input type="number" id="amountPaid" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="changeAmount" class="text-sm font-medium text-gray-700 mb-1">Change (MMK)</label>
<input type="number" id="changeAmount" readonly class="p-3 border border-gray-300 rounded-lg bg-gray-100">
</div>
<div class="flex flex-col">
<label for="saleNotes" class="text-sm font-medium text-gray-700 mb-1">Notes</label>
<textarea id="saleNotes" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
</div>
<div class="flex space-x-4">
<button id="completeSaleButton" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 flex-1">Complete Sale</button>
<button id="printReceiptButton" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 flex-1">Print Receipt</button>
</div>
</div>
</div>
 
</div>
</div>
</div>

<!-- Suppliers View -->
<div id="suppliersView" class="view hidden" aria-labelledby="suppliers-heading">
<h2 id="suppliers-heading" class="text-3xl font-bold text-gray-900 mb-6">Supplier Management</h2>
<div class="bg-white rounded-lg p-6 shadow-md mb-6">
<form id="supplierForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
<input type="hidden" id="supplierId">
<div class="flex flex-col">
<label for="supplierName" class="text-sm font-medium text-gray-700 mb-1">Supplier Name</label>
<input type="text" id="supplierName" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="supplierPhone" class="text-sm font-medium text-gray-700 mb-1">Phone Number</label>
<input type="tel" id="supplierPhone" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="supplierEmail" class="text-sm font-medium text-gray-700 mb-1">Email</label>
<input type="email" id="supplierEmail" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="supplierAddress" class="text-sm font-medium text-gray-700 mb-1">Address</label>
<textarea id="supplierAddress" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
</div>
<div class="flex items-end col-span-1 md:col-span-2 space-x-4">
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Supplier</button>
<button type="button" id="supplierClearBtn" class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-200">Clear Form</button>
</div>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-4 md:space-y-0">
<h3 class="text-xl font-semibold text-gray-800">Supplier List</h3>
<div class="flex space-x-2 w-full md:w-auto">
<label for="supplierSearch" class="sr-only">Search suppliers</label>
<input type="text" id="supplierSearch" placeholder="Search suppliers..." class="w-full md:w-64 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<button id="supplierSearchButton" class="bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition-colors duration-200" aria-label="Search suppliers">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
</svg>
</button>
</div>
</div>

	<!-- Supplier Payment History & Totals -->
	<div class="bg-white rounded-lg p-6 shadow-md mt-6">
		<div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
			<div class="flex-1">
				<label for="supplierPaymentSelect" class="text-sm font-medium text-gray-700 mb-1">Select Supplier</label>
				<select id="supplierPaymentSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
					<option value="">Select a supplier</option>
				</select>
			</div>

			<div class="grid grid-cols-2 md:grid-cols-4 gap-4 flex-1">
				<div class="p-4 bg-gray-50 rounded">
					<div class="text-xs text-gray-500">Total Pieces</div>
					<div id="supplierTotalPieces" class="text-lg font-semibold">0</div>
				</div>
				<div class="p-4 bg-gray-50 rounded">
					<div class="text-xs text-gray-500">Total Buying</div>
					<div id="supplierTotalBuying" class="text-lg font-semibold">0 MMK</div>
				</div>
				<div class="p-4 bg-gray-50 rounded">
					<div class="text-xs text-gray-500">Paid</div>
					<div id="supplierTotalPaid" class="text-lg font-semibold text-green-600">0 MMK</div>
				</div>
				<div class="p-4 bg-gray-50 rounded">
					<div class="text-xs text-gray-500">Remaining</div>
					<div id="supplierTotalRemaining" class="text-lg font-semibold text-red-600">0 MMK</div>
				</div>
			</div>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
			<div class="md:col-span-1">
				<h4 class="text-md font-semibold text-gray-800 mb-3">Record Payment</h4>
				<div class="space-y-3">
					<div class="flex flex-col">
						<label for="supplierPaymentAmount" class="text-sm font-medium text-gray-700 mb-1">Amount (MMK)</label>
						<input type="number" id="supplierPaymentAmount" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
					</div>
					<div class="flex flex-col">
						<label for="supplierPaymentDate" class="text-sm font-medium text-gray-700 mb-1">Date</label>
						<input type="date" id="supplierPaymentDate" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
					</div>
					<div class="flex flex-col">
						<label for="supplierPaymentNotes" class="text-sm font-medium text-gray-700 mb-1">Notes</label>
						<textarea id="supplierPaymentNotes" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Optional note..."></textarea>
					</div>
					<button id="addSupplierPaymentBtn" class="w-full bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Add Payment</button>
				</div>
			</div>
			<div class="md:col-span-2">
				<div class="flex items-center justify-between mb-3">
					<h4 class="text-md font-semibold text-gray-800">Payment History</h4>
				</div>
				<div class="overflow-x-auto">
					<table class="min-w-full divide-y divide-gray-200">
						<thead class="bg-gray-50">
							<tr>
								<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
								<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
								<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
								<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
							</tr>
						</thead>
						<tbody id="supplierPaymentHistoryBody" class="bg-white divide-y divide-gray-200">
							<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No payments recorded</td></tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
</tr>
</thead>
<tbody id="supplierList" class="bg-white divide-y divide-gray-200">
<!-- Supplier list will be rendered here -->
<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No suppliers added yet</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- Expenses View -->
<div id="expensesView" class="view hidden" aria-labelledby="expenses-heading">
<h2 id="expenses-heading" class="text-3xl font-bold text-gray-900 mb-6">Expense Management</h2>
<div class="bg-white rounded-lg p-6 shadow-md mb-6">
<form id="expenseForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
<input type="hidden" id="expenseId">
<div class="flex flex-col">
<label for="expenseCategory" class="text-sm font-medium text-gray-700 mb-1">Category</label>
<select id="expenseCategory" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
<option value="">Select Category</option>
<option value="Rent">Rent</option>
<option value="Utilities">Utilities</option>
<option value="Salaries">Salaries</option>
<option value="Marketing">Marketing</option>
<option value="Supplies">Supplies</option>
<option value="Maintenance">Maintenance</option>
<option value="Other">Other</option>
</select>
</div>
<div class="flex flex-col">
<label for="expenseAmount" class="text-sm font-medium text-gray-700 mb-1">Amount (MMK)</label>
<input type="number" id="expenseAmount" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="expenseDate" class="text-sm font-medium text-gray-700 mb-1">Date</label>
<input type="date" id="expenseDate" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="expenseDescription" class="text-sm font-medium text-gray-700 mb-1">Description</label>
<textarea id="expenseDescription" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
</div>
<div class="flex items-end col-span-1 md:col-span-2 space-x-4">
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Expense</button>
<button type="button" id="expenseClearBtn" class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-200">Clear Form</button>
</div>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-4 md:space-y-0">
<h3 class="text-xl font-semibold text-gray-800">Expense List</h3>
<div class="flex space-x-2 w-full md:w-auto">
<label for="expenseSearch" class="sr-only">Search expenses</label>
<input type="text" id="expenseSearch" placeholder="Search expenses..." class="w-full md:w-64 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<button id="expenseSearchButton" class="bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition-colors duration-200" aria-label="Search expenses">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
</svg>
</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
</tr>
</thead>
<tbody id="expenseList" class="bg-white divide-y divide-gray-200">
<!-- Expense list will be rendered here -->
<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No expenses added yet</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- Customers View -->
<div id="customersView" class="view hidden" aria-labelledby="customers-heading">
<h2 id="customers-heading" class="text-3xl font-bold text-gray-900 mb-6">Customer Management</h2>
<div class="bg-white rounded-lg p-6 shadow-md mb-6">
<form id="customerForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
<input type="hidden" id="customerId">
<div class="flex flex-col">
<label for="customerName" class="text-sm font-medium text-gray-700 mb-1">Customer Name</label>
<input type="text" id="customerName" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-required="true">
</div>
<div class="flex flex-col">
<label for="customerPhone" class="text-sm font-medium text-gray-700 mb-1">Phone Number</label>
<input type="tel" id="customerPhone" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="customerEmail" class="text-sm font-medium text-gray-700 mb-1">Email</label>
<input type="email" id="customerEmail" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="customerAddress" class="text-sm font-medium text-gray-700 mb-1">Address</label>
<textarea id="customerAddress" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
</div>
<div class="flex items-end col-span-1 md:col-span-2 space-x-4">
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Customer</button>
<button type="button" id="customerClearBtn" class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-200">Clear Form</button>
</div>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-4 md:space-y-0">
<h3 class="text-xl font-semibold text-gray-800">Customer List</h3>
<div class="flex space-x-2 w-full md:w-auto">
<label for="customerSearch" class="sr-only">Search customers</label>
<input type="text" id="customerSearch" placeholder="Search customers..." class="w-full md:w-64 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<button id="customerSearchButton" class="bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition-colors duration-200" aria-label="Search customers">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
</svg>
</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address</th>
<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
</tr>
</thead>
<tbody id="customerList" class="bg-white divide-y divide-gray-200">
<!-- Customer list will be rendered here -->
<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No customers added yet</td></tr>
</tbody>
</table>
</div>
</div>
</div>

<!-- Reports View -->
<div id="reportsView" class="view hidden" aria-labelledby="reports-heading">
<h2 id="reports-heading" class="text-3xl font-bold text-gray-900 mb-6">Reports</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Generate Report</h3>
<form id="reportForm" class="space-y-4">
<div class="flex flex-col">
<label for="reportType" class="text-sm font-medium text-gray-700 mb-1">Report Type</label>
<select id="reportType" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<option value="sales">Sales Report</option>
<option value="inventory">Inventory Report</option>
<option value="profit">Profit Report</option>
<option value="expenses">Expenses Report</option>
</select>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="flex flex-col">
<label for="startDate" class="text-sm font-medium text-gray-700 mb-1">Start Date</label>
<input type="date" id="startDate" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="endDate" class="text-sm font-medium text-gray-700 mb-1">End Date</label>
<input type="date" id="endDate" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
</div>
<div class="flex space-x-4">
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Generate Report</button>
<button type="button" id="exportReportButton" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200">Export to Excel</button>
</div>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Quick Stats</h3>
<div class="space-y-4">
<div class="flex justify-between items-center">
<span class="text-gray-600">Today's Sales</span>
<span class="font-semibold" id="todaySales">0 MMK</span>
</div>
<div class="flex justify-between items-center">
<span class="text-gray-600">This Month's Sales</span>
<span class="font-semibold" id="monthSales">0 MMK</span>
</div>
<div class="flex justify-between items-center">
<span class="text-gray-600">This Month's Profit</span>
<span class="font-semibold" id="monthProfit">0 MMK</span>
</div>
<div class="flex justify-between items-center">
<span class="text-gray-600">Low Stock Items</span>
<span class="font-semibold" id="lowStockCount">0</span>
</div>
</div>
</div>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Report Results</h3>
<div id="reportResults" class="overflow-x-auto">
<!-- Report results will be rendered here -->
<p class="text-center text-gray-500">Generate a report to see results</p>
</div>
</div>
</div>

<!-- Settings View -->
<div id="settingsView" class="view hidden" aria-labelledby="settings-heading">
<h2 id="settings-heading" class="text-3xl font-bold text-gray-900 mb-6">Settings</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Company Information</h3>
<form id="companyForm" class="space-y-4">
<div class="flex flex-col">
<label for="companyName" class="text-sm font-medium text-gray-700 mb-1">Company Name</label>
<input type="text" id="companyName" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" value="Swift POS">
</div>
<div class="flex flex-col">
<label for="companyLogo" class="text-sm font-medium text-gray-700 mb-1">Company Logo</label>
<input type="file" id="companyLogo" accept="image/*" class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex flex-col">
<label for="companyAddress" class="text-sm font-medium text-gray-700 mb-1">Address</label>
<textarea id="companyAddress" rows="3" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
</div>
<div class="flex flex-col">
<label for="companyPhone" class="text-sm font-medium text-gray-700 mb-1">Phone Number</label>
<input type="tel" id="companyPhone" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Company Info</button>
</form>
</div>
<div class="bg-white rounded-lg p-6 shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-4">System Settings</h3>
<form id="systemForm" class="space-y-4">
<div class="flex flex-col">
<label for="currency" class="text-sm font-medium text-gray-700 mb-1">Currency</label>
<select id="currency" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
<option value="MMK">Myanmar Kyat (MMK)</option>
<option value="USD">US Dollar (USD)</option>
<option value="EUR">Euro (EUR)</option>
</select>
</div>
<div class="flex flex-col">
<label for="taxRate" class="text-sm font-medium text-gray-700 mb-1">Tax Rate (%)</label>
<input type="number" id="taxRate" min="0" max="100" value="0" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
</div>
<div class="flex items-center">
<input type="checkbox" id="enableNotifications" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<label for="enableNotifications" class="ml-2 text-sm font-medium text-gray-700">Enable Notifications</label>
</div>
<div class="flex items-center">
<input type="checkbox" id="enableSound" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<label for="enableSound" class="ml-2 text-sm font-medium text-gray-700">Enable Sound Effects</label>
</div>
<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save System Settings</button>
</form>
</div>
</div>
<div class="bg-white rounded-lg p-6 shadow-md mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Data Management</h3>
		<div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
<button id="exportDataButton" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200">Export Data</button>
<button id="importDataButton" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200">Import Data</button>
<button id="resetDataButton" class="bg-red-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200">Reset Data</button>
</div>
</div>

	<div class="bg-white rounded-lg p-6 shadow-md mt-6">
		<h3 class="text-xl font-semibold text-gray-800 mb-4">Storage Preferences</h3>
		<form id="storageForm" class="space-y-4">
			<div class="flex items-center gap-6">
				<label class="flex items-center gap-2">
					<input type="radio" name="storageType" value="local" class="text-indigo-600" checked>
					<span>Local Folder</span>
				</label>
				<label class="flex items-center gap-2">
					<input type="radio" name="storageType" value="online" class="text-indigo-600">
					<span>Online Folder (URL)</span>
				</label>
			</div>
			<div class="flex flex-col md:flex-row md:items-center gap-2">
				<label for="storagePath" class="text-sm font-medium text-gray-700 mb-1 md:mb-0">Path or URL</label>
				<input type="text" id="storagePath" class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="/Users/me/Documents or https://drive.google.com/...">
				<button type="button" id="pickLocalFolderButton" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">Choose Folder</button>
			</div>
			<button type="submit" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">Save Storage Preference</button>
		</form>
	</div>
</div>
</main>

<!-- Footer -->
<footer class="w-full bg-gray-800 text-white py-4 text-center">
<p>&copy; 2023 Swift POS. All rights reserved.</p>
</footer>

<!-- Toast Notifications -->
<div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

<script>
// ===========================
// APP INITIALIZATION
// ===========================

// DOM Elements
const views = {
dashboard: document.getElementById('dashboardView'),
products: document.getElementById('productsView'),
sales: document.getElementById('salesView'),
suppliers: document.getElementById('suppliersView'),
expenses: document.getElementById('expensesView'),
customers: document.getElementById('customersView'),
reports: document.getElementById('reportsView'),
settings: document.getElementById('settingsView')
};

// Tab buttons
const tabButtons = {
dashboard: document.getElementById('dashboardTab'),
products: document.getElementById('productsTab'),
sales: document.getElementById('salesTab'),
suppliers: document.getElementById('suppliersTab'),
expenses: document.getElementById('expensesTab'),
customers: document.getElementById('customersTab'),
reports: document.getElementById('reportsTab'),
settings: document.getElementById('settingsTab')
};

// Mobile navigation
const mobileNavSelect = document.getElementById('mobileNavSelect');
const mobileMenuButton = document.getElementById('mobileMenuButton');
const closeSidebar = document.getElementById('closeSidebar');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');

// Charts
let salesChart, monthlyProfitChart, bestSellingProductsChart, salesByCategoryChart;

// ===========================
// DATA MANAGEMENT
// ===========================

// Initialize data storage
function initializeData() {
if (!localStorage.getItem('products')) {
localStorage.setItem('products', JSON.stringify([]));
}
if (!localStorage.getItem('sales')) {
localStorage.setItem('sales', JSON.stringify([]));
}
if (!localStorage.getItem('suppliers')) {
localStorage.setItem('suppliers', JSON.stringify([]));
}
if (!localStorage.getItem('expenses')) {
localStorage.setItem('expenses', JSON.stringify([]));
}
if (!localStorage.getItem('customers')) {
localStorage.setItem('customers', JSON.stringify([]));
}
if (!localStorage.getItem('companyInfo')) {
localStorage.setItem('companyInfo', JSON.stringify({
name: 'Swift POS',
logo: '',
address: '',
phone: ''
}));
}
		if (!localStorage.getItem('systemSettings')) {
localStorage.setItem('systemSettings', JSON.stringify({
currency: 'MMK',
taxRate: 0,
enableNotifications: true,
				enableSound: true,
				storagePreference: { type: 'local', path: '' }
}));
}
		if (!localStorage.getItem('categories')) {
			localStorage.setItem('categories', JSON.stringify(['Tops','Dresses','Pants','Shoes','Accessories']));
		}
}

// Data retrieval functions
function getProducts() {
return JSON.parse(localStorage.getItem('products')) || [];
}

function getSales() {
return JSON.parse(localStorage.getItem('sales')) || [];
}

function getSuppliers() {
return JSON.parse(localStorage.getItem('suppliers')) || [];
}

function getExpenses() {
return JSON.parse(localStorage.getItem('expenses')) || [];
}

function getCustomers() {
return JSON.parse(localStorage.getItem('customers')) || [];
}

function getCompanyInfo() {
return JSON.parse(localStorage.getItem('companyInfo')) || {};
}

function getSystemSettings() {
return JSON.parse(localStorage.getItem('systemSettings')) || {};
}

	function getCategories() {
		return JSON.parse(localStorage.getItem('categories')) || [];
	}

// Data update functions
function saveProducts(products) {
localStorage.setItem('products', JSON.stringify(products));
}

function saveSales(sales) {
localStorage.setItem('sales', JSON.stringify(sales));
}

function saveSuppliers(suppliers) {
localStorage.setItem('suppliers', JSON.stringify(suppliers));
}

function saveExpenses(expenses) {
localStorage.setItem('expenses', JSON.stringify(expenses));
}

function saveCustomers(customers) {
localStorage.setItem('customers', JSON.stringify(customers));
}

function saveCompanyInfo(info) {
localStorage.setItem('companyInfo', JSON.stringify(info));
}

function saveSystemSettings(settings) {
localStorage.setItem('systemSettings', JSON.stringify(settings));
}

	function saveCategories(categories) {
		localStorage.setItem('categories', JSON.stringify(categories));
	}

// ===========================
// UTILITY FUNCTIONS
// ===========================

// Format currency
function formatCurrency(amount) {
const settings = getSystemSettings();
const currency = settings.currency || 'MMK';
const formatter = new Intl.NumberFormat('en-US', {
style: 'currency',
currency: currency,
minimumFractionDigits: 0,
maximumFractionDigits: 0
});
return formatter.format(amount);
}

// Show toast notification
function showToast(message, type = 'info') {
const toastContainer = document.getElementById('toastContainer');
const toast = document.createElement('div');
toast.className = `p-4 rounded-lg shadow-lg text-white ${
type === 'success' ? 'bg-green-500' :
type === 'error' ? 'bg-red-500' :
type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
} transform transition-all duration-300 ease-in-out translate-x-full`;
toast.textContent = message;
toastContainer.appendChild(toast);

// Animate in
setTimeout(() => {
toast.classList.remove('translate-x-full');
}, 10);

// Remove after 3 seconds
setTimeout(() => {
toast.classList.add('translate-x-full');
setTimeout(() => {
toastContainer.removeChild(toast);
}, 300);
}, 3000);
}

// Generate unique ID
function generateId() {
return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

// Validate email
function isValidEmail(email) {
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
return emailRegex.test(email);
}

// Validate phone number
function isValidPhone(phone) {
const phoneRegex = /^\+?[\d\s-()]{10,}$/;
return phoneRegex.test(phone);
}

// ===========================
// VIEW MANAGEMENT
// ===========================

// Show a specific view
function showView(viewName) {
// Hide all views
Object.values(views).forEach(view => {
view.classList.add('hidden');
});

// Show the selected view
views[viewName].classList.remove('hidden');

// Update active tab
Object.values(tabButtons).forEach(button => {
button.classList.remove('active-tab');
});
tabButtons[viewName].classList.add('active-tab');

// Update mobile nav select
mobileNavSelect.value = viewName;

// Close mobile sidebar if open
sidebar.classList.remove('open');
overlay.classList.remove('open');

// Load view-specific data
switch (viewName) {
case 'dashboard':
loadDashboardData();
break;
case 'products':
loadProducts();
		loadSuppliersForProducts();
		attachCategoryAddHandler();
break;
case 'sales':
loadProductsForSales();
loadCustomersForSales();
break;
case 'suppliers':
		loadSuppliers();
		initializeSupplierPaymentsUI();
break;
case 'expenses':
loadExpenses();
break;
case 'customers':
loadCustomers();
break;
case 'reports':
loadReports();
break;
case 'settings':
loadSettings();
break;
}
}

// ===========================
// DASHBOARD FUNCTIONALITY
// ===========================

function loadDashboardData() {
const sales = getSales();
const products = getProducts();
const expenses = getExpenses();
const companyInfo = getCompanyInfo();

// Update company info
document.getElementById('dashboardCompanyName').textContent = companyInfo.name || 'Swift POS';
document.getElementById('dashboardCompanyLogo').src = companyInfo.logo || '';

// Update current date
const now = new Date();
document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});

// Calculate totals
const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
const totalProfit = sales.reduce((sum, sale) => sum + sale.profit, 0);
const totalProducts = products.length;
const totalCreditPayments = expenses.filter(expense => expense.category === 'Credit Payment').reduce((sum, expense) => sum + expense.amount, 0);

// Update dashboard cards
document.getElementById('totalSales').textContent = formatCurrency(totalSales);
document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);
document.getElementById('totalProducts').textContent = totalProducts;
document.getElementById('totalCreditPayments').textContent = formatCurrency(totalCreditPayments);

// Update charts
updateCharts(sales, products);

// Update additional analytics
updateAnalytics(sales, products);

// Update supplier payments
updateSupplierPayments(expenses);
}

function updateCharts(sales, products) {
// Sales trends chart (last 7 days)
const last7Days = Array.from({ length: 7 }, (_, i) => {
const date = new Date();
date.setDate(date.getDate() - i);
return date.toISOString().split('T')[0];
}).reverse();

const salesByDay = last7Days.map(date => {
const daySales = sales.filter(sale => sale.date === date);
return daySales.reduce((sum, sale) => sum + sale.total, 0);
});

const salesCtx = document.getElementById('salesChart').getContext('2d');
if (salesChart) salesChart.destroy();
salesChart = new Chart(salesCtx, {
type: 'line',
data: {
labels: last7Days.map(date => new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })),
datasets: [{
label: 'Sales',
data: salesByDay,
borderColor: '#4f46e5',
backgroundColor: 'rgba(79, 70, 229, 0.1)',
tension: 0.3,
fill: true
}]
},
options: {
responsive: true,
plugins: {
legend: {
display: false
}
},
scales: {
y: {
beginAtZero: true,
ticks: {
callback: function(value) {
return formatCurrency(value);
}
}
}
}
}
});

// Monthly profit chart
const currentYear = new Date().getFullYear();
const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
const profitByMonth = months.map((month, index) => {
const monthSales = sales.filter(sale => {
const saleDate = new Date(sale.date);
return saleDate.getFullYear() === currentYear && saleDate.getMonth() === index;
});
return monthSales.reduce((sum, sale) => sum + sale.profit, 0);
});

const profitCtx = document.getElementById('monthlyProfitChart').getContext('2d');
if (monthlyProfitChart) monthlyProfitChart.destroy();
monthlyProfitChart = new Chart(profitCtx, {
type: 'bar',
data: {
labels: months,
datasets: [{
label: 'Profit',
data: profitByMonth,
backgroundColor: '#10b981',
borderColor: '#10b981',
borderWidth: 1
}]
},
options: {
responsive: true,
plugins: {
legend: {
display: false
}
},
scales: {
y: {
beginAtZero: true,
ticks: {
callback: function(value) {
return formatCurrency(value);
}
}
}
}
}
});

// Best selling products chart
const productSales = {};
sales.forEach(sale => {
sale.items.forEach(item => {
if (!productSales[item.productId]) {
productSales[item.productId] = 0;
}
productSales[item.productId] += item.quantity;
});
});

const topProducts = Object.entries(productSales)
.map(([productId, quantity]) => {
const product = products.find(p => p.id === productId);
return {
name: product ? product.name : 'Unknown Product',
quantity: quantity
};
})
.sort((a, b) => b.quantity - a.quantity)
.slice(0, 5);

const bestSellingCtx = document.getElementById('bestSellingProductsChart').getContext('2d');
if (bestSellingProductsChart) bestSellingProductsChart.destroy();
bestSellingProductsChart = new Chart(bestSellingCtx, {
type: 'doughnut',
data: {
labels: topProducts.map(p => p.name),
datasets: [{
data: topProducts.map(p => p.quantity),
backgroundColor: [
'#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'
],
borderWidth: 1
}]
},
options: {
responsive: true,
plugins: {
legend: {
position: 'bottom'
}
}
}
});

// Sales by category chart
const categorySales = {};
sales.forEach(sale => {
sale.items.forEach(item => {
const product = products.find(p => p.id === item.productId);
if (product) {
if (!categorySales[product.category]) {
categorySales[product.category] = 0;
}
categorySales[product.category] += item.total;
}
});
});

const categoryCtx = document.getElementById('salesByCategoryChart').getContext('2d');
if (salesByCategoryChart) salesByCategoryChart.destroy();
salesByCategoryChart = new Chart(categoryCtx, {
type: 'pie',
data: {
labels: Object.keys(categorySales),
datasets: [{
data: Object.values(categorySales),
backgroundColor: [
'#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#f97316'
],
borderWidth: 1
}]
},
options: {
responsive: true,
plugins: {
legend: {
position: 'bottom'
}
}
}
});
}

function updateAnalytics(sales, products) {
// Top 10 selling items
const productSales = {};
sales.forEach(sale => {
sale.items.forEach(item => {
if (!productSales[item.productId]) {
productSales[item.productId] = {
quantity: 0,
revenue: 0
};
}
productSales[item.productId].quantity += item.quantity;
productSales[item.productId].revenue += item.total;
});
});

const topSellingItems = Object.entries(productSales)
.map(([productId, data]) => {
const product = products.find(p => p.id === productId);
return {
name: product ? product.name : 'Unknown Product',
quantity: data.quantity,
revenue: data.revenue
};
})
.sort((a, b) => b.quantity - a.quantity)
.slice(0, 10);

const topSellingContainer = document.getElementById('topSellingItems');
if (topSellingItems.length > 0) {
topSellingContainer.innerHTML = topSellingItems.map((item, index) => `
<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
<span class="text-sm font-medium">${index + 1}. ${item.name}</span>
<span class="text-xs text-gray-600">${item.quantity} sold</span>
</div>
`).join('');
} else {
topSellingContainer.innerHTML = '<p class="text-gray-500 text-center">No sales data available</p>';
}

// Low stock items
const lowStockItems = products.filter(product => product.stock < 10)
.sort((a, b) => a.stock - b.stock)
.slice(0, 10);

const lowStockContainer = document.getElementById('lowStockItems');
if (lowStockItems.length > 0) {
lowStockContainer.innerHTML = lowStockItems.map(item => `
<div class="flex justify-between items-center p-2 bg-red-50 rounded">
<span class="text-sm font-medium">${item.name}</span>
<span class="text-xs text-red-600">${item.stock} left</span>
</div>
`).join('');
} else {
lowStockContainer.innerHTML = '<p class="text-gray-500 text-center">No low stock items</p>';
}

// Least selling items
const leastSellingItems = Object.entries(productSales)
.map(([productId, data]) => {
const product = products.find(p => p.id === productId);
return {
name: product ? product.name : 'Unknown Product',
quantity: data.quantity,
revenue: data.revenue
};
})
.filter(item => item.quantity > 0) // Only include items that have been sold
.sort((a, b) => a.quantity - b.quantity)
.slice(0, 10);

const leastSellingContainer = document.getElementById('leastSellingItems');
if (leastSellingItems.length > 0) {
leastSellingContainer.innerHTML = leastSellingItems.map((item, index) => `
<div class="flex justify-between items-center p-2 bg-yellow-50 rounded">
<span class="text-sm font-medium">${index + 1}. ${item.name}</span>
<span class="text-xs text-yellow-600">${item.quantity} sold</span>
</div>
`).join('');
} else {
leastSellingContainer.innerHTML = '<p class="text-gray-500 text-center">No sales data available</p>';
}
}

function updateSupplierPayments(expenses) {
const supplierPayments = expenses
.filter(expense => expense.category === 'Supplier Payment')
.sort((a, b) => new Date(b.date) - new Date(a.date))
.slice(0, 5);

const paymentsContainer = document.getElementById('supplierPaymentsDashboard');
if (supplierPayments.length > 0) {
paymentsContainer.innerHTML = supplierPayments.map(payment => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${payment.description || 'Supplier Payment'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(payment.date).toLocaleDateString()}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(payment.amount)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${payment.notes || ''}</td>
</tr>
`).join('');
} else {
paymentsContainer.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No recent payments</td></tr>';
}
}

// ===========================
// PRODUCTS FUNCTIONALITY
// ===========================

function loadProducts() {
const products = getProducts();
		const productList = document.getElementById('productList');
		populateProductCategorySelect();

if (products.length === 0) {
productList.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No products added yet</td></tr>';
return;
}

productList.innerHTML = products.map(product => `
<tr>
<td class="px-6 py-4 whitespace-nowrap">
<div class="flex items-center">
${product.image ? `<img src="${product.image}" alt="${product.name}" class="h-10 w-10 rounded-full object-cover mr-3">` : ''}
<div>
<div class="text-sm font-medium text-gray-900">${product.name}</div>
${product.barcode ? `<div class="text-sm text-gray-500">Barcode: ${product.barcode}</div>` : ''}
</div>
</div>
</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 ${product.stock < 10 ? 'text-red-600 font-semibold' : ''}">${product.stock}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.buyingPrice)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.sellingPrice)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-product" data-id="${product.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-product" data-id="${product.id}">Delete</button>
</td>
</tr>
`).join('');

// Add event listeners to edit and delete buttons
document.querySelectorAll('.edit-product').forEach(button => {
button.addEventListener('click', function() {
const productId = this.getAttribute('data-id');
editProduct(productId);
});
});

document.querySelectorAll('.delete-product').forEach(button => {
button.addEventListener('click', function() {
const productId = this.getAttribute('data-id');
deleteProduct(productId);
});
});
}

function loadSuppliersForProducts() {
const suppliers = getSuppliers();
const supplierSelect = document.getElementById('productSupplier');
supplierSelect.innerHTML = '<option value="">Select a supplier</option>' +
suppliers.map(supplier => `<option value="${supplier.id}">${supplier.name}</option>`).join('');
}

function editProduct(productId) {
const products = getProducts();
const product = products.find(p => p.id === productId);

if (product) {
document.getElementById('productId').value = product.id;
document.getElementById('productName').value = product.name;
		populateProductCategorySelect();
		document.getElementById('productCategory').value = product.category;
document.getElementById('productStock').value = product.stock;
document.getElementById('productBuyingPrice').value = product.buyingPrice;
document.getElementById('productSellingPrice').value = product.sellingPrice;
document.getElementById('productSize').value = product.size || '';
document.getElementById('productColor').value = product.color || '';
document.getElementById('productSupplier').value = product.supplierId || '';
document.getElementById('productBarcode').value = product.barcode || '';

// Scroll to form
document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
}
}

function deleteProduct(productId) {
if (confirm('Are you sure you want to delete this product?')) {
const products = getProducts();
const updatedProducts = products.filter(p => p.id !== productId);
saveProducts(updatedProducts);
loadProducts();
showToast('Product deleted successfully', 'success');
}
}

// Product form submission
document.getElementById('productForm').addEventListener('submit', function(e) {
e.preventDefault();

const productId = document.getElementById('productId').value;
const name = document.getElementById('productName').value.trim();
const category = document.getElementById('productCategory').value;
const stock = parseInt(document.getElementById('productStock').value);
const buyingPrice = parseFloat(document.getElementById('productBuyingPrice').value);
const sellingPrice = parseFloat(document.getElementById('productSellingPrice').value);
const size = document.getElementById('productSize').value.trim();
const color = document.getElementById('productColor').value.trim();
const supplierId = document.getElementById('productSupplier').value;
const barcode = document.getElementById('productBarcode').value.trim();

if (!name || !category || isNaN(stock) || isNaN(buyingPrice) || isNaN(sellingPrice)) {
showToast('Please fill in all required fields', 'error');
return;
}

if (sellingPrice <= buyingPrice) {
showToast('Selling price must be greater than buying price', 'error');
return;
}

const products = getProducts();
const imageFile = document.getElementById('productImage').files[0];

if (productId) {
// Update existing product
const index = products.findIndex(p => p.id === productId);
if (index !== -1) {
products[index] = {
...products[index],
name,
category,
stock,
buyingPrice,
sellingPrice,
size: size || null,
color: color || null,
supplierId: supplierId || null,
barcode: barcode || null
};

// Handle image upload if provided
if (imageFile) {
const reader = new FileReader();
reader.onload = function(e) {
products[index].image = e.target.result;
saveProducts(products);
loadProducts();
showToast('Product updated successfully', 'success');
resetProductForm();
};
reader.readAsDataURL(imageFile);
} else {
saveProducts(products);
loadProducts();
showToast('Product updated successfully', 'success');
resetProductForm();
}
}
} else {
// Add new product
const newProduct = {
id: generateId(),
name,
category,
stock,
buyingPrice,
sellingPrice,
size: size || null,
color: color || null,
supplierId: supplierId || null,
barcode: barcode || null,
image: null
};

if (imageFile) {
const reader = new FileReader();
reader.onload = function(e) {
newProduct.image = e.target.result;
products.push(newProduct);
saveProducts(products);
loadProducts();
showToast('Product added successfully', 'success');
resetProductForm();
};
reader.readAsDataURL(imageFile);
} else {
products.push(newProduct);
saveProducts(products);
loadProducts();
showToast('Product added successfully', 'success');
resetProductForm();
}
}
});

function resetProductForm() {
document.getElementById('productForm').reset();
document.getElementById('productId').value = '';
		populateProductCategorySelect();
}

	function attachCategoryAddHandler() {
		const addBtn = document.getElementById('addCategoryButton');
		const input = document.getElementById('newCategoryInput');
		if (!addBtn || !input) return;
		addBtn.onclick = function() {
			const newCat = (input.value || '').trim();
			if (!newCat) {
				showToast('Enter a category name', 'error');
				return;
			}
			const categories = getCategories();
			if (categories.includes(newCat)) {
				showToast('Category already exists', 'warning');
				return;
			}
			categories.push(newCat);
			saveCategories(categories);
			populateProductCategorySelect();
			document.getElementById('productCategory').value = newCat;
			populateSalesFilters();
			input.value = '';
			showToast('Category added', 'success');
		};
	}

document.getElementById('productClearBtn').addEventListener('click', resetProductForm);

// Product search
document.getElementById('productSearchButton').addEventListener('click', function() {
const searchTerm = document.getElementById('productSearch').value.toLowerCase();
const products = getProducts();
const filteredProducts = products.filter(product =>
product.name.toLowerCase().includes(searchTerm) ||
product.category.toLowerCase().includes(searchTerm) ||
(product.barcode && product.barcode.toLowerCase().includes(searchTerm))
);

const productList = document.getElementById('productList');
if (filteredProducts.length === 0) {
productList.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No products found</td></tr>';
return;
}

productList.innerHTML = filteredProducts.map(product => `
<tr>
<td class="px-6 py-4 whitespace-nowrap">
<div class="flex items-center">
${product.image ? `<img src="${product.image}" alt="${product.name}" class="h-10 w-10 rounded-full object-cover mr-3">` : ''}
<div>
<div class="text-sm font-medium text-gray-900">${product.name}</div>
${product.barcode ? `<div class="text-sm text-gray-500">Barcode: ${product.barcode}</div>` : ''}
</div>
</div>
</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 ${product.stock < 10 ? 'text-red-600 font-semibold' : ''}">${product.stock}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.buyingPrice)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.sellingPrice)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-product" data-id="${product.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-product" data-id="${product.id}">Delete</button>
</td>
</tr>
`).join('');

// Reattach event listeners
document.querySelectorAll('.edit-product').forEach(button => {
button.addEventListener('click', function() {
const productId = this.getAttribute('data-id');
editProduct(productId);
});
});

document.querySelectorAll('.delete-product').forEach(button => {
button.addEventListener('click', function() {
const productId = this.getAttribute('data-id');
deleteProduct(productId);
});
});
});

// ===========================
// SALES FUNCTIONALITY
// ===========================

let cart = [];

function loadProductsForSales() {
		const products = getProducts();
		populateSalesFilters();
		renderSalesProductGrid(products);
}

	function populateSalesFilters() {
		const categories = getCategories();
		const chips = document.getElementById('salesCategoryChips');
		if (chips) {
			chips.innerHTML = categories.map(c => `
				<button type="button" class="px-3 py-1 rounded-full border text-sm sales-chip" data-cat="${c}">${c}</button>
			`).join('');
			chips.querySelectorAll('.sales-chip').forEach(btn => {
				btn.addEventListener('click', function() {
					this.classList.toggle('bg-indigo-600');
					this.classList.toggle('text-white');
					applySalesFilters();
				});
			});
		}
		const search = document.getElementById('salesSearch');
		if (search) {
			search.removeEventListener('input', onSalesSearchChange);
			search.addEventListener('input', onSalesSearchChange);
		}
	}

	function populateProductCategorySelect() {
		const categories = getCategories();
		const select = document.getElementById('productCategory');
		if (!select) return;
		const current = select.value;
		select.innerHTML = '<option value="">Select Category</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
		if (current) select.value = current;
	}

	function onSalesSearchChange() {
		applySalesFilters();
	}

	function onSalesFilterChange() {
		applySalesFilters();
	}

	function applySalesFilters() {
		const allProducts = getProducts();
		const term = (document.getElementById('salesSearch').value || '').toLowerCase();
		const selectedCats = Array.from(document.querySelectorAll('#salesCategoryChips .sales-chip.bg-indigo-600')).map(b => b.getAttribute('data-cat'));
		const filtered = allProducts.filter(p =>
			(selectedCats.length === 0 || selectedCats.includes(p.category)) &&
			(p.name.toLowerCase().includes(term) || (p.barcode || '').toLowerCase().includes(term))
		);
		renderSalesProductGrid(filtered);
	}

	function renderSalesProductGrid(products) {
		const grid = document.getElementById('salesProductGrid');
		if (!grid) return;
		if (!products || products.length === 0) {
			grid.innerHTML = '<p class="text-gray-500 col-span-full text-center">No products</p>';
			return;
		}
		grid.innerHTML = products.map(p => `
			<button class="border rounded-lg p-3 text-left hover:shadow focus:outline-none focus:ring-2 focus:ring-indigo-500 add-to-cart-card" data-id="${p.id}">
				${p.image ? `<img src="${p.image}" alt="${p.name}" class="w-full h-28 object-cover rounded mb-2">` : ''}
				<div class="flex justify-between items-center">
					<span class="font-semibold truncate">${p.name}</span>
					<span class="text-sm text-gray-500">${formatCurrency(p.sellingPrice)}</span>
				</div>
				<div class="text-xs text-gray-600 mt-1">${p.category || 'Uncategorized'}</div>
				<div class="text-xs mt-1 ${p.stock <= 0 ? 'text-red-600 font-semibold' : 'text-gray-600'}">Stock left: ${p.stock}</div>
			</button>
		`).join('');
		grid.querySelectorAll('.add-to-cart-card').forEach(btn => {
			btn.addEventListener('click', function() {
				addProductCardToCart(this.getAttribute('data-id'));
			});
		});
	}

	function addProductCardToCart(productId) {
		const quantity = 1;
		const discount = parseFloat(document.getElementById('discountInput').value) || 0;
		const products = getProducts();
		const product = products.find(p => p.id === productId);
		if (!product) {
			showToast('Product not found', 'error');
			return;
		}
		if (product.stock < quantity) {
			showToast(`Insufficient stock. Only ${product.stock} available`, 'error');
			return;
		}
		const existingItemIndex = cart.findIndex(item => item.productId === productId);
		if (existingItemIndex !== -1) {
			cart[existingItemIndex].quantity += quantity;
			cart[existingItemIndex].discount = discount;
			cart[existingItemIndex].total = calculateItemTotal(product.sellingPrice, cart[existingItemIndex].quantity, discount);
		} else {
			const item = {
				id: generateId(),
				productId,
				name: product.name,
				price: product.sellingPrice,
				quantity,
				discount,
				total: calculateItemTotal(product.sellingPrice, quantity, discount)
			};
			cart.push(item);
		}
		updateCartDisplay();
		updateReceipt();
		showToast('Product added to cart', 'success');
	}

function loadCustomersForSales() {
const customers = getCustomers();
const customerSelect = document.getElementById('customerSelect');
// Clear existing options except the first two
customerSelect.innerHTML = '<option value="walk-in">Walk-in Customer</option><option value="online">Online Customer</option>';
// Add customers to the dropdown
customers.forEach(customer => {
customerSelect.innerHTML += `<option value="${customer.id}">${customer.name}</option>`;
});
}

function addToCart() {
const productId = document.getElementById('productSelect').value;
const quantity = parseInt(document.getElementById('quantityInput').value);
const discount = parseFloat(document.getElementById('discountInput').value);

if (!productId) {
showToast('Please select a product', 'error');
return;
}

if (isNaN(quantity) || quantity <= 0) {
showToast('Please enter a valid quantity', 'error');
return;
}

const products = getProducts();
const product = products.find(p => p.id === productId);

if (!product) {
showToast('Product not found', 'error');
return;
}

if (product.stock < quantity) {
showToast(`Insufficient stock. Only ${product.stock} available`, 'error');
return;
}

// Check if product already in cart
const existingItemIndex = cart.findIndex(item => item.productId === productId);

if (existingItemIndex !== -1) {
// Update existing item
cart[existingItemIndex].quantity += quantity;
cart[existingItemIndex].discount = discount;
cart[existingItemIndex].total = calculateItemTotal(product.sellingPrice, cart[existingItemIndex].quantity, discount);
} else {
// Add new item
const item = {
id: generateId(),
productId,
name: product.name,
price: product.sellingPrice,
quantity,
discount,
total: calculateItemTotal(product.sellingPrice, quantity, discount)
};
cart.push(item);
}

updateCartDisplay();
updateReceipt();
resetSaleForm();
showToast('Product added to cart', 'success');
}

function calculateItemTotal(price, quantity, discount) {
const discountedPrice = price * (1 - discount / 100);
return discountedPrice * quantity;
}

function updateCartDisplay() {
const cartItems = document.getElementById('cartItems');
const cartTotal = document.getElementById('cartTotal');

if (cart.length === 0) {
cartItems.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No items in cart</td></tr>';
cartTotal.textContent = '0';
return;
}

cartItems.innerHTML = cart.map(item => `
<tr>
		<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.price)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.quantity}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.discount}%</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.total)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
		<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-cart-item" data-id="${item.id}">Edit</button>
		<button class="text-red-600 hover:text-red-900 remove-from-cart" data-id="${item.id}">Remove</button>
</td>
</tr>
`).join('');

const total = cart.reduce((sum, item) => sum + item.total, 0);
cartTotal.textContent = formatCurrency(total);

// Update amount paid field
document.getElementById('amountPaid').value = total;

// Add event listeners to remove buttons
		document.querySelectorAll('.remove-from-cart').forEach(button => {
button.addEventListener('click', function() {
const itemId = this.getAttribute('data-id');
removeFromCart(itemId);
});
});
		document.querySelectorAll('.edit-cart-item').forEach(button => {
			button.addEventListener('click', function() {
				const itemId = this.getAttribute('data-id');
				editCartItem(itemId);
			});
		});
}

function removeFromCart(itemId) {
cart = cart.filter(item => item.id !== itemId);
updateCartDisplay();
updateReceipt();
showToast('Item removed from cart', 'success');
}

function editCartItem(itemId) {
const itemIndex = cart.findIndex(i => i.id === itemId);
if (itemIndex === -1) return;
const item = cart[itemIndex];
const newQty = parseInt(prompt('Enter quantity:', String(item.quantity)));
if (!isFinite(newQty) || newQty <= 0) {
    showToast('Invalid quantity', 'error');
    return;
}
const newDiscount = parseFloat(prompt('Enter discount (%):', String(item.discount)));
if (!isFinite(newDiscount) || newDiscount < 0 || newDiscount > 100) {
    showToast('Invalid discount', 'error');
    return;
}
// Validate against stock
const products = getProducts();
const product = products.find(p => p.id === item.productId);
if (product && product.stock < newQty) {
    showToast(`Insufficient stock. Only ${product.stock} available`, 'error');
    return;
}
item.quantity = newQty;
item.discount = newDiscount;
item.total = calculateItemTotal(item.price, newQty, newDiscount);
updateCartDisplay();
updateReceipt();
showToast('Item updated', 'success');
}

function clearCart() {
if (cart.length === 0) {
showToast('Cart is already empty', 'info');
return;
}

if (confirm('Are you sure you want to clear the cart?')) {
cart = [];
updateCartDisplay();
updateReceipt();
showToast('Cart cleared', 'success');
}
}

function resetSaleForm() {
document.getElementById('quantityInput').value = 1;
document.getElementById('discountInput').value = 0;
}

function updateReceipt() {
const receiptItems = document.getElementById('receiptItems');
const receiptTotal = document.getElementById('receiptTotal');
const receiptPaid = document.getElementById('receiptPaid');
const receiptChange = document.getElementById('receiptChange');
const receiptDate = document.getElementById('receiptDate');

if (cart.length === 0) {
receiptItems.innerHTML = '<p class="text-center text-gray-500">No items</p>';
receiptTotal.textContent = '0 MMK';
receiptPaid.textContent = '0 MMK';
receiptChange.textContent = '0 MMK';
} else {
receiptItems.innerHTML = cart.map(item => `
<div class="flex justify-between text-sm">
<span>${item.name} x${item.quantity}</span>
<span>${formatCurrency(item.total)}</span>
</div>
`).join('');

let total = cart.reduce((sum, item) => sum + item.total, 0);
const orderDiscount = Math.min(100, Math.max(0, parseFloat(document.getElementById('orderDiscount')?.value) || 0));
total = total * (1 - orderDiscount / 100);
receiptTotal.textContent = formatCurrency(total);

const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
receiptPaid.textContent = formatCurrency(amountPaid);
receiptChange.textContent = formatCurrency(Math.max(0, amountPaid - total));
}

receiptDate.textContent = new Date().toLocaleDateString('en-US', {
year: 'numeric',
month: 'short',
day: 'numeric',
hour: '2-digit',
minute: '2-digit'
});
}

function completeSale() {
if (cart.length === 0) {
showToast('Cart is empty', 'error');
return;
}

const customerType = document.getElementById('customerSelect').value;
const paymentMethod = document.getElementById('paymentMethod').value;
const amountPaid = parseFloat(document.getElementById('amountPaid').value);
const notes = document.getElementById('saleNotes').value.trim();

const total = cart.reduce((sum, item) => sum + item.total, 0);

if (isNaN(amountPaid) || amountPaid < total) {
showToast(`Amount paid must be at least ${formatCurrency(total)}`, 'error');
return;
}

// Update product stocks
const products = getProducts();
cart.forEach(item => {
const productIndex = products.findIndex(p => p.id === item.productId);
if (productIndex !== -1) {
products[productIndex].stock -= item.quantity;
}
});
saveProducts(products);

// Create sale record
const sale = {
id: generateId(),
date: new Date().toISOString().split('T')[0],
time: new Date().toLocaleTimeString(),
customerType,
paymentMethod,
items: [...cart],
total,
profit: cart.reduce((sum, item) => {
const product = products.find(p => p.id === item.productId);
if (product) {
return sum + (item.total - (product.buyingPrice * item.quantity));
}
return sum;
}, 0),
amountPaid,
orderDiscount: Math.min(100, Math.max(0, parseFloat(document.getElementById('orderDiscount')?.value) || 0)),
change: amountPaid - total,
notes
};

const sales = getSales();
sales.push(sale);
saveSales(sales);

// Show success message
showToast('Sale completed successfully', 'success');

// Reset cart and form
cart = [];
updateCartDisplay();
updateReceipt();
document.getElementById('saleNotes').value = '';

// Update dashboard if visible
if (!views.dashboard.classList.contains('hidden')) {
loadDashboardData();
}
}

function printReceipt() {
if (cart.length === 0) {
showToast('No items to print', 'error');
return;
}

const receiptContent = document.getElementById('receiptContent').innerHTML;
const printWindow = window.open('', '_blank');
printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
<title>Receipt</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.receipt { max-width: 300px; margin: 0 auto; }
.text-center { text-align: center; }
.border-t { border-top: 1px solid #000; }
.border-b { border-bottom: 1px solid #000; }
.py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
.mb-4 { margin-bottom: 1rem; }
.flex { display: flex; }
.justify-between { justify-content: space-between; }
.font-semibold { font-weight: 600; }
.text-sm { font-size: 0.875rem; }
</style>
</head>
<body>
${receiptContent}
</body>
</html>
`);
printWindow.document.close();
printWindow.print();
}

// Sales event listeners
const addToCartBtnEl = document.getElementById('addToCartButton');
if (addToCartBtnEl) addToCartBtnEl.addEventListener('click', addToCart);
const clearCartBtnEl = document.getElementById('clearCartButton');
if (clearCartBtnEl) clearCartBtnEl.addEventListener('click', clearCart);
const completeSaleBtnEl = document.getElementById('completeSaleButton');
if (completeSaleBtnEl) completeSaleBtnEl.addEventListener('click', completeSale);
const printReceiptBtnEl = document.getElementById('printReceiptButton');
if (printReceiptBtnEl) printReceiptBtnEl.addEventListener('click', printReceipt);

// Update change amount when amount paid changes
document.getElementById('amountPaid').addEventListener('input', function() {
let total = cart.reduce((sum, item) => sum + item.total, 0);
const orderDiscount = Math.min(100, Math.max(0, parseFloat(document.getElementById('orderDiscount')?.value) || 0));
total = total * (1 - orderDiscount / 100);
const amountPaid = parseFloat(this.value) || 0;
const change = Math.max(0, amountPaid - total);
document.getElementById('changeAmount').value = change;
updateReceipt();
});

// ===========================
// SUPPLIERS FUNCTIONALITY
// ===========================

function loadSuppliers() {
const suppliers = getSuppliers();
const supplierList = document.getElementById('supplierList');

if (suppliers.length === 0) {
supplierList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No suppliers added yet</td></tr>';
return;
}

	// ===========================
	// SUPPLIER PAYMENTS (BY SUPPLIER)
	// ===========================

	function initializeSupplierPaymentsUI() {
		populateSupplierPaymentSelect();
		// default date today
		const dateInput = document.getElementById('supplierPaymentDate');
		if (dateInput) {
			dateInput.value = new Date().toISOString().split('T')[0];
		}
		const select = document.getElementById('supplierPaymentSelect');
		if (select) {
			select.removeEventListener('change', onSupplierPaymentSelectChange);
			select.addEventListener('change', onSupplierPaymentSelectChange);
		}
		const addBtn = document.getElementById('addSupplierPaymentBtn');
		if (addBtn) {
			addBtn.removeEventListener('click', onAddSupplierPayment);
			addBtn.addEventListener('click', onAddSupplierPayment);
		}
		// Recompute if already selected
		if (select && select.value) {
			updateSupplierPaymentSummary(select.value);
			renderSupplierPaymentHistory(select.value);
		}
	}

	function populateSupplierPaymentSelect() {
		const suppliers = getSuppliers();
		const select = document.getElementById('supplierPaymentSelect');
		if (!select) return;
		const current = select.value;
		select.innerHTML = '<option value="">Select a supplier</option>' +
			suppliers.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
		if (current) {
			select.value = current;
		}
	}

	function onSupplierPaymentSelectChange(e) {
		const supplierId = e.target.value;
		updateSupplierPaymentSummary(supplierId);
		renderSupplierPaymentHistory(supplierId);
	}

	function updateSupplierPaymentSummary(supplierId) {
		const totalPiecesEl = document.getElementById('supplierTotalPieces');
		const totalBuyingEl = document.getElementById('supplierTotalBuying');
		const totalPaidEl = document.getElementById('supplierTotalPaid');
		const remainingEl = document.getElementById('supplierTotalRemaining');
		if (!supplierId) {
			if (totalPiecesEl) totalPiecesEl.textContent = '0';
			if (totalBuyingEl) totalBuyingEl.textContent = formatCurrency(0);
			if (totalPaidEl) totalPaidEl.textContent = formatCurrency(0);
			if (remainingEl) remainingEl.textContent = formatCurrency(0);
			return;
		}
		const products = getProducts();
		const expenses = getExpenses();
		const supplierProducts = products.filter(p => p.supplierId === supplierId);
		const totalPieces = supplierProducts.reduce((sum, p) => sum + (parseInt(p.stock, 10) || 0), 0);
		const totalBuying = supplierProducts.reduce((sum, p) => sum + ((parseFloat(p.buyingPrice) || 0) * ((parseInt(p.stock, 10) || 0))), 0);
		const paid = expenses
			.filter(e => e.category === 'Supplier Payment' && e.supplierId === supplierId)
			.reduce((sum, e) => sum + (parseFloat(e.amount) || 0), 0);
		const remaining = Math.max(0, totalBuying - paid);
		if (totalPiecesEl) totalPiecesEl.textContent = String(totalPieces);
		if (totalBuyingEl) totalBuyingEl.textContent = formatCurrency(totalBuying);
		if (totalPaidEl) totalPaidEl.textContent = formatCurrency(paid);
		if (remainingEl) remainingEl.textContent = formatCurrency(remaining);
	}

	function renderSupplierPaymentHistory(supplierId) {
		const tbody = document.getElementById('supplierPaymentHistoryBody');
		if (!tbody) return;
		if (!supplierId) {
			tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">Select a supplier</td></tr>';
			return;
		}
		const expenses = getExpenses()
			.filter(e => e.category === 'Supplier Payment' && e.supplierId === supplierId)
			.sort((a, b) => new Date(b.date) - new Date(a.date));
		if (expenses.length === 0) {
			tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No payments recorded</td></tr>';
			return;
		}
		tbody.innerHTML = expenses.map(e => `
			<tr>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(e.date).toLocaleDateString()}</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(e.amount)}</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${e.description || ''}</td>
				<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
					<button class="text-red-600 hover:text-red-900 delete-supplier-payment" data-id="${e.id}" data-supplier="${supplierId}">Delete</button>
				</td>
			</tr>
		`).join('');
		// Attach delete handlers
		tbody.querySelectorAll('.delete-supplier-payment').forEach(btn => {
			btn.addEventListener('click', function() {
				const id = this.getAttribute('data-id');
				const sid = this.getAttribute('data-supplier');
				deleteSupplierPayment(id, sid);
			});
		});
	}

	function onAddSupplierPayment(e) {
		e.preventDefault();
		const supplierId = document.getElementById('supplierPaymentSelect').value;
		const amount = parseFloat(document.getElementById('supplierPaymentAmount').value);
		const date = document.getElementById('supplierPaymentDate').value;
		const notes = document.getElementById('supplierPaymentNotes').value.trim();
		if (!supplierId) {
			showToast('Please select a supplier', 'error');
			return;
		}
		if (isNaN(amount) || amount <= 0 || !date) {
			showToast('Enter valid amount and date', 'error');
			return;
		}
		const expenses = getExpenses();
		const newExpense = {
			id: generateId(),
			category: 'Supplier Payment',
			amount,
			date,
			description: notes || null,
			supplierId
		};
		expenses.push(newExpense);
		saveExpenses(expenses);
		showToast('Supplier payment recorded', 'success');
		// clear amount and notes
		document.getElementById('supplierPaymentAmount').value = '';
		document.getElementById('supplierPaymentNotes').value = '';
		updateSupplierPaymentSummary(supplierId);
		renderSupplierPaymentHistory(supplierId);
	}

	function deleteSupplierPayment(expenseId, supplierId) {
		if (!confirm('Delete this payment?')) return;
		const expenses = getExpenses();
		const updated = expenses.filter(e => e.id !== expenseId);
		saveExpenses(updated);
		showToast('Payment deleted', 'success');
		updateSupplierPaymentSummary(supplierId);
		renderSupplierPaymentHistory(supplierId);
	}

supplierList.innerHTML = suppliers.map(supplier => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${supplier.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.phone || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.email || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.address || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-supplier" data-id="${supplier.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-supplier" data-id="${supplier.id}">Delete</button>
</td>
</tr>
`).join('');

// Add event listeners to edit and delete buttons
document.querySelectorAll('.edit-supplier').forEach(button => {
button.addEventListener('click', function() {
const supplierId = this.getAttribute('data-id');
editSupplier(supplierId);
});
});

document.querySelectorAll('.delete-supplier').forEach(button => {
button.addEventListener('click', function() {
const supplierId = this.getAttribute('data-id');
deleteSupplier(supplierId);
});
});
}

function editSupplier(supplierId) {
const suppliers = getSuppliers();
const supplier = suppliers.find(s => s.id === supplierId);

if (supplier) {
document.getElementById('supplierId').value = supplier.id;
document.getElementById('supplierName').value = supplier.name;
document.getElementById('supplierPhone').value = supplier.phone || '';
document.getElementById('supplierEmail').value = supplier.email || '';
document.getElementById('supplierAddress').value = supplier.address || '';

// Scroll to form
document.getElementById('supplierForm').scrollIntoView({ behavior: 'smooth' });
}
}

function deleteSupplier(supplierId) {
if (confirm('Are you sure you want to delete this supplier?')) {
const suppliers = getSuppliers();
const updatedSuppliers = suppliers.filter(s => s.id !== supplierId);
saveSuppliers(updatedSuppliers);
loadSuppliers();
showToast('Supplier deleted successfully', 'success');
}
}

// Supplier form submission
document.getElementById('supplierForm').addEventListener('submit', function(e) {
e.preventDefault();

const supplierId = document.getElementById('supplierId').value;
const name = document.getElementById('supplierName').value.trim();
const phone = document.getElementById('supplierPhone').value.trim();
const email = document.getElementById('supplierEmail').value.trim();
const address = document.getElementById('supplierAddress').value.trim();

if (!name) {
showToast('Supplier name is required', 'error');
return;
}

if (email && !isValidEmail(email)) {
showToast('Please enter a valid email address', 'error');
return;
}

if (phone && !isValidPhone(phone)) {
showToast('Please enter a valid phone number', 'error');
return;
}

const suppliers = getSuppliers();

if (supplierId) {
// Update existing supplier
const index = suppliers.findIndex(s => s.id === supplierId);
if (index !== -1) {
suppliers[index] = {
...suppliers[index],
name,
phone: phone || null,
email: email || null,
address: address || null
};
saveSuppliers(suppliers);
loadSuppliers();
showToast('Supplier updated successfully', 'success');
resetSupplierForm();
}
} else {
// Add new supplier
const newSupplier = {
id: generateId(),
name,
phone: phone || null,
email: email || null,
address: address || null
};
suppliers.push(newSupplier);
saveSuppliers(suppliers);
loadSuppliers();
showToast('Supplier added successfully', 'success');
resetSupplierForm();
}
});

function resetSupplierForm() {
document.getElementById('supplierForm').reset();
document.getElementById('supplierId').value = '';
}

document.getElementById('supplierClearBtn').addEventListener('click', resetSupplierForm);

// Supplier search
document.getElementById('supplierSearchButton').addEventListener('click', function() {
const searchTerm = document.getElementById('supplierSearch').value.toLowerCase();
const suppliers = getSuppliers();
const filteredSuppliers = suppliers.filter(supplier =>
supplier.name.toLowerCase().includes(searchTerm) ||
(supplier.phone && supplier.phone.toLowerCase().includes(searchTerm)) ||
(supplier.email && supplier.email.toLowerCase().includes(searchTerm))
);

const supplierList = document.getElementById('supplierList');
if (filteredSuppliers.length === 0) {
supplierList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No suppliers found</td></tr>';
return;
}

supplierList.innerHTML = filteredSuppliers.map(supplier => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${supplier.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.phone || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.email || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${supplier.address || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-supplier" data-id="${supplier.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-supplier" data-id="${supplier.id}">Delete</button>
</td>
</tr>
`).join('');

// Reattach event listeners
document.querySelectorAll('.edit-supplier').forEach(button => {
button.addEventListener('click', function() {
const supplierId = this.getAttribute('data-id');
editSupplier(supplierId);
});
});

document.querySelectorAll('.delete-supplier').forEach(button => {
button.addEventListener('click', function() {
const supplierId = this.getAttribute('data-id');
deleteSupplier(supplierId);
});
});
});

// ===========================
// EXPENSES FUNCTIONALITY
// ===========================

function loadExpenses() {
const expenses = getExpenses();
const expenseList = document.getElementById('expenseList');

if (expenses.length === 0) {
expenseList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No expenses added yet</td></tr>';
return;
}

expenseList.innerHTML = expenses.map(expense => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${expense.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(expense.amount)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(expense.date).toLocaleDateString()}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${expense.description || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-expense" data-id="${expense.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-expense" data-id="${expense.id}">Delete</button>
</td>
</tr>
`).join('');

// Add event listeners to edit and delete buttons
document.querySelectorAll('.edit-expense').forEach(button => {
button.addEventListener('click', function() {
const expenseId = this.getAttribute('data-id');
editExpense(expenseId);
});
});

document.querySelectorAll('.delete-expense').forEach(button => {
button.addEventListener('click', function() {
const expenseId = this.getAttribute('data-id');
deleteExpense(expenseId);
});
});
}

function editExpense(expenseId) {
const expenses = getExpenses();
const expense = expenses.find(e => e.id === expenseId);

if (expense) {
document.getElementById('expenseId').value = expense.id;
document.getElementById('expenseCategory').value = expense.category;
document.getElementById('expenseAmount').value = expense.amount;
document.getElementById('expenseDate').value = expense.date;
document.getElementById('expenseDescription').value = expense.description || '';

// Scroll to form
document.getElementById('expenseForm').scrollIntoView({ behavior: 'smooth' });
}
}

function deleteExpense(expenseId) {
if (confirm('Are you sure you want to delete this expense?')) {
const expenses = getExpenses();
const updatedExpenses = expenses.filter(e => e.id !== expenseId);
saveExpenses(updatedExpenses);
loadExpenses();
showToast('Expense deleted successfully', 'success');
}
}

// Expense form submission
document.getElementById('expenseForm').addEventListener('submit', function(e) {
e.preventDefault();

const expenseId = document.getElementById('expenseId').value;
const category = document.getElementById('expenseCategory').value;
const amount = parseFloat(document.getElementById('expenseAmount').value);
const date = document.getElementById('expenseDate').value;
const description = document.getElementById('expenseDescription').value.trim();

if (!category || isNaN(amount) || !date) {
showToast('Please fill in all required fields', 'error');
return;
}

if (amount <= 0) {
showToast('Amount must be greater than 0', 'error');
return;
}

const expenses = getExpenses();

if (expenseId) {
// Update existing expense
const index = expenses.findIndex(e => e.id === expenseId);
if (index !== -1) {
expenses[index] = {
...expenses[index],
category,
amount,
date,
description: description || null
};
saveExpenses(expenses);
loadExpenses();
showToast('Expense updated successfully', 'success');
resetExpenseForm();
}
} else {
// Add new expense
const newExpense = {
id: generateId(),
category,
amount,
date,
description: description || null
};
expenses.push(newExpense);
saveExpenses(expenses);
loadExpenses();
showToast('Expense added successfully', 'success');
resetExpenseForm();
}
});

function resetExpenseForm() {
document.getElementById('expenseForm').reset();
document.getElementById('expenseId').value = '';
document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
}

document.getElementById('expenseClearBtn').addEventListener('click', resetExpenseForm);

// Expense search
document.getElementById('expenseSearchButton').addEventListener('click', function() {
const searchTerm = document.getElementById('expenseSearch').value.toLowerCase();
const expenses = getExpenses();
const filteredExpenses = expenses.filter(expense =>
expense.category.toLowerCase().includes(searchTerm) ||
(expense.description && expense.description.toLowerCase().includes(searchTerm))
);

const expenseList = document.getElementById('expenseList');
if (filteredExpenses.length === 0) {
expenseList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No expenses found</td></tr>';
return;
}

expenseList.innerHTML = filteredExpenses.map(expense => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${expense.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(expense.amount)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(expense.date).toLocaleDateString()}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${expense.description || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-expense" data-id="${expense.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-expense" data-id="${expense.id}">Delete</button>
</td>
</tr>
`).join('');

// Reattach event listeners
document.querySelectorAll('.edit-expense').forEach(button => {
button.addEventListener('click', function() {
const expenseId = this.getAttribute('data-id');
editExpense(expenseId);
});
});

document.querySelectorAll('.delete-expense').forEach(button => {
button.addEventListener('click', function() {
const expenseId = this.getAttribute('data-id');
deleteExpense(expenseId);
});
});
});

// ===========================
// CUSTOMERS FUNCTIONALITY
// ===========================

function loadCustomers() {
const customers = getCustomers();
const customerList = document.getElementById('customerList');

if (customers.length === 0) {
customerList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No customers added yet</td></tr>';
return;
}

customerList.innerHTML = customers.map(customer => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${customer.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.phone || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.email || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.address || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-customer" data-id="${customer.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-customer" data-id="${customer.id}">Delete</button>
</td>
</tr>
`).join('');

// Add event listeners to edit and delete buttons
document.querySelectorAll('.edit-customer').forEach(button => {
button.addEventListener('click', function() {
const customerId = this.getAttribute('data-id');
editCustomer(customerId);
});
});

document.querySelectorAll('.delete-customer').forEach(button => {
button.addEventListener('click', function() {
const customerId = this.getAttribute('data-id');
deleteCustomer(customerId);
});
});
}

function editCustomer(customerId) {
const customers = getCustomers();
const customer = customers.find(c => c.id === customerId);

if (customer) {
document.getElementById('customerId').value = customer.id;
document.getElementById('customerName').value = customer.name;
document.getElementById('customerPhone').value = customer.phone || '';
document.getElementById('customerEmail').value = customer.email || '';
document.getElementById('customerAddress').value = customer.address || '';

// Scroll to form
document.getElementById('customerForm').scrollIntoView({ behavior: 'smooth' });
}
}

function deleteCustomer(customerId) {
if (confirm('Are you sure you want to delete this customer?')) {
const customers = getCustomers();
const updatedCustomers = customers.filter(c => c.id !== customerId);
saveCustomers(updatedCustomers);
loadCustomers();
showToast('Customer deleted successfully', 'success');
}
}

// Customer form submission
document.getElementById('customerForm').addEventListener('submit', function(e) {
e.preventDefault();

const customerId = document.getElementById('customerId').value;
const name = document.getElementById('customerName').value.trim();
const phone = document.getElementById('customerPhone').value.trim();
const email = document.getElementById('customerEmail').value.trim();
const address = document.getElementById('customerAddress').value.trim();

if (!name) {
showToast('Customer name is required', 'error');
return;
}

if (email && !isValidEmail(email)) {
showToast('Please enter a valid email address', 'error');
return;
}

if (phone && !isValidPhone(phone)) {
showToast('Please enter a valid phone number', 'error');
return;
}

const customers = getCustomers();

if (customerId) {
// Update existing customer
const index = customers.findIndex(c => c.id === customerId);
if (index !== -1) {
customers[index] = {
...customers[index],
name,
phone: phone || null,
email: email || null,
address: address || null
};
saveCustomers(customers);
loadCustomers();
showToast('Customer updated successfully', 'success');
resetCustomerForm();
}
} else {
// Add new customer
const newCustomer = {
id: generateId(),
name,
phone: phone || null,
email: email || null,
address: address || null
};
customers.push(newCustomer);
saveCustomers(customers);
loadCustomers();
showToast('Customer added successfully', 'success');
resetCustomerForm();
}
});

function resetCustomerForm() {
document.getElementById('customerForm').reset();
document.getElementById('customerId').value = '';
}

document.getElementById('customerClearBtn').addEventListener('click', resetCustomerForm);

// Customer search
document.getElementById('customerSearchButton').addEventListener('click', function() {
const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
const customers = getCustomers();
const filteredCustomers = customers.filter(customer =>
customer.name.toLowerCase().includes(searchTerm) ||
(customer.phone && customer.phone.toLowerCase().includes(searchTerm)) ||
(customer.email && customer.email.toLowerCase().includes(searchTerm))
);

const customerList = document.getElementById('customerList');
if (filteredCustomers.length === 0) {
customerList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No customers found</td></tr>';
return;
}

customerList.innerHTML = filteredCustomers.map(customer => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${customer.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.phone || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.email || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.address || 'N/A'}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
<button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-customer" data-id="${customer.id}">Edit</button>
<button class="text-red-600 hover:text-red-900 delete-customer" data-id="${customer.id}">Delete</button>
</td>
</tr>
`).join('');

// Reattach event listeners
document.querySelectorAll('.edit-customer').forEach(button => {
button.addEventListener('click', function() {
const customerId = this.getAttribute('data-id');
editCustomer(customerId);
});
});

document.querySelectorAll('.delete-customer').forEach(button => {
button.addEventListener('click', function() {
const customerId = this.getAttribute('data-id');
deleteCustomer(customerId);
});
});
});

// ===========================
// REPORTS FUNCTIONALITY
// ===========================

function loadReports() {
const sales = getSales();
const products = getProducts();
const expenses = getExpenses();

// Update quick stats
const today = new Date().toISOString().split('T')[0];
const todaySales = sales.filter(sale => sale.date === today)
.reduce((sum, sale) => sum + sale.total, 0);
document.getElementById('todaySales').textContent = formatCurrency(todaySales);

const currentMonth = new Date().getMonth();
const currentYear = new Date().getFullYear();
const monthSales = sales.filter(sale => {
const saleDate = new Date(sale.date);
return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
}).reduce((sum, sale) => sum + sale.total, 0);
document.getElementById('monthSales').textContent = formatCurrency(monthSales);

const monthProfit = sales.filter(sale => {
const saleDate = new Date(sale.date);
return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
}).reduce((sum, sale) => sum + sale.profit, 0);
document.getElementById('monthProfit').textContent = formatCurrency(monthProfit);

const lowStockCount = products.filter(product => product.stock < 10).length;
document.getElementById('lowStockCount').textContent = lowStockCount;
}

// Report form submission
document.getElementById('reportForm').addEventListener('submit', function(e) {
e.preventDefault();

const reportType = document.getElementById('reportType').value;
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;

if (!startDate || !endDate) {
showToast('Please select both start and end dates', 'error');
return;
}

if (new Date(startDate) > new Date(endDate)) {
showToast('Start date cannot be after end date', 'error');
return;
}

generateReport(reportType, startDate, endDate);
});

function generateReport(type, startDate, endDate) {
const sales = getSales();
const products = getProducts();
const expenses = getExpenses();

const filteredSales = sales.filter(sale => {
const saleDate = new Date(sale.date);
return saleDate >= new Date(startDate) && saleDate <= new Date(endDate);
});

const filteredExpenses = expenses.filter(expense => {
const expenseDate = new Date(expense.date);
return expenseDate >= new Date(startDate) && expenseDate <= new Date(endDate);
});

let reportHTML = '';

switch (type) {
case 'sales':
reportHTML = generateSalesReport(filteredSales, products);
break;
case 'inventory':
reportHTML = generateInventoryReport(products);
break;
case 'profit':
reportHTML = generateProfitReport(filteredSales, products);
break;
case 'expenses':
reportHTML = generateExpensesReport(filteredExpenses);
break;
}

document.getElementById('reportResults').innerHTML = reportHTML;
}

function generateSalesReport(sales, products) {
if (sales.length === 0) {
return '<p class="text-center text-gray-500">No sales data for the selected period</p>';
}

const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
const totalItems = sales.reduce((sum, sale) => sum + sale.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0);

let productSales = {};
sales.forEach(sale => {
sale.items.forEach(item => {
if (!productSales[item.productId]) {
productSales[item.productId] = {
quantity: 0,
revenue: 0
};
}
productSales[item.productId].quantity += item.quantity;
productSales[item.productId].revenue += item.total;
});
});

const productSalesArray = Object.entries(productSales)
.map(([productId, data]) => {
const product = products.find(p => p.id === productId);
return {
name: product ? product.name : 'Unknown Product',
...data
};
})
.sort((a, b) => b.revenue - a.revenue);

return `
<div class="mb-4">
<h4 class="text-lg font-semibold">Sales Summary</h4>
<p>Total Sales: <strong>${formatCurrency(totalSales)}</strong></p>
<p>Total Items Sold: <strong>${totalItems}</strong></p>
<p>Number of Transactions: <strong>${sales.length}</strong></p>
</div>
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity Sold</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
</tr>
</thead>
<tbody class="bg-white divide-y divide-gray-200">
${productSalesArray.map(item => `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.quantity}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.revenue)}</td>
</tr>
`).join('')}
</tbody>
</table>
`;
}

function generateInventoryReport(products) {
if (products.length === 0) {
return '<p class="text-center text-gray-500">No products in inventory</p>';
}

const lowStockProducts = products.filter(p => p.stock < 10);
const outOfStockProducts = products.filter(p => p.stock === 0);
const totalValue = products.reduce((sum, product) => sum + (product.buyingPrice * product.stock), 0);

return `
<div class="mb-4">
<h4 class="text-lg font-semibold">Inventory Summary</h4>
<p>Total Products: <strong>${products.length}</strong></p>
<p>Low Stock Items: <strong>${lowStockProducts.length}</strong></p>
<p>Out of Stock Items: <strong>${outOfStockProducts.length}</strong></p>
<p>Total Inventory Value: <strong>${formatCurrency(totalValue)}</strong></p>
</div>
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Buying Price</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
</tr>
</thead>
<tbody class="bg-white divide-y divide-gray-200">
${products.map(product => `
<tr class="${product.stock === 0 ? 'bg-red-50' : product.stock < 10 ? 'bg-yellow-50' : ''}">
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 ${product.stock === 0 ? 'text-red-600 font-semibold' : product.stock < 10 ? 'text-yellow-600 font-semibold' : ''}">${product.stock}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.buyingPrice)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(product.buyingPrice * product.stock)}</td>
</tr>
`).join('')}
</tbody>
</table>
`;
}

function generateProfitReport(sales, products) {
if (sales.length === 0) {
return '<p class="text-center text-gray-500">No sales data for the selected period</p>';
}

const totalRevenue = sales.reduce((sum, sale) => sum + sale.total, 0);
const totalCost = sales.reduce((sum, sale) => {
const saleCost = sale.items.reduce((itemSum, item) => {
const product = products.find(p => p.id === item.productId);
return itemSum + (product ? product.buyingPrice * item.quantity : 0);
}, 0);
return sum + saleCost;
}, 0);
const totalProfit = totalRevenue - totalCost;
const profitMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;

let productProfit = {};
sales.forEach(sale => {
sale.items.forEach(item => {
const product = products.find(p => p.id === item.productId);
if (product) {
if (!productProfit[item.productId]) {
productProfit[item.productId] = {
revenue: 0,
cost: 0,
profit: 0
};
}
productProfit[item.productId].revenue += item.total;
productProfit[item.productId].cost += product.buyingPrice * item.quantity;
productProfit[item.productId].profit += item.total - (product.buyingPrice * item.quantity);
}
});
});

const productProfitArray = Object.entries(productProfit)
.map(([productId, data]) => {
const product = products.find(p => p.id === productId);
return {
name: product ? product.name : 'Unknown Product',
...data
};
})
.sort((a, b) => b.profit - a.profit);

return `
<div class="mb-4">
<h4 class="text-lg font-semibold">Profit Summary</h4>
<p>Total Revenue: <strong>${formatCurrency(totalRevenue)}</strong></p>
<p>Total Cost: <strong>${formatCurrency(totalCost)}</strong></p>
<p>Total Profit: <strong>${formatCurrency(totalProfit)}</strong></p>
<p>Profit Margin: <strong>${profitMargin.toFixed(2)}%</strong></p>
</div>
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cost</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profit</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Margin</th>
</tr>
</thead>
<tbody class="bg-white divide-y divide-gray-200">
${productProfitArray.map(item => {
const margin = item.revenue > 0 ? (item.profit / item.revenue) * 100 : 0;
return `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.revenue)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.cost)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 ${item.profit < 0 ? 'text-red-600' : 'text-green-600'}">${formatCurrency(item.profit)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 ${margin < 0 ? 'text-red-600' : 'text-green-600'}">${margin.toFixed(2)}%</td>
</tr>
`;
}).join('')}
</tbody>
</table>
`;
}

function generateExpensesReport(expenses) {
if (expenses.length === 0) {
return '<p class="text-center text-gray-500">No expenses for the selected period</p>';
}

const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);

let categoryExpenses = {};
expenses.forEach(expense => {
if (!categoryExpenses[expense.category]) {
categoryExpenses[expense.category] = 0;
}
categoryExpenses[expense.category] += expense.amount;
});

const categoryExpensesArray = Object.entries(categoryExpenses)
.map(([category, amount]) => ({ category, amount }))
.sort((a, b) => b.amount - a.amount);

return `
<div class="mb-4">
<h4 class="text-lg font-semibold">Expenses Summary</h4>
<p>Total Expenses: <strong>${formatCurrency(totalExpenses)}</strong></p>
<p>Number of Expenses: <strong>${expenses.length}</strong></p>
</div>
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Percentage</th>
</tr>
</thead>
<tbody class="bg-white divide-y divide-gray-200">
${categoryExpensesArray.map(item => {
const percentage = (item.amount / totalExpenses) * 100;
return `
<tr>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.category}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(item.amount)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${percentage.toFixed(2)}%</td>
</tr>
`;
}).join('')}
</tbody>
</table>
`;
}

// Export report to Excel
document.getElementById('exportReportButton').addEventListener('click', function() {
const reportResults = document.getElementById('reportResults');
if (reportResults.innerHTML.includes('text-gray-500')) {
showToast('No report data to export', 'error');
return;
}

// Create a simple CSV export (for demonstration)
const tables = reportResults.getElementsByTagName('table');
if (tables.length === 0) {
showToast('No table data to export', 'error');
return;
}

const table = tables[0];
let csv = [];
for (let i = 0; i < table.rows.length; i++) {
let row = [];
for (let j = 0; j < table.rows[i].cells.length; j++) {
row.push(table.rows[i].cells[j].textContent);
}
csv.push(row.join(','));
}

const csvContent = 'data:text/csv;charset=utf-8,' + csv.join('\n');
const encodedUri = encodeURI(csvContent);
const link = document.createElement('a');
link.setAttribute('href', encodedUri);
link.setAttribute('download', 'report.csv');
document.body.appendChild(link);
link.click();
document.body.removeChild(link);

showToast('Report exported successfully', 'success');
});

// ===========================
// SETTINGS FUNCTIONALITY
// ===========================

function loadSettings() {
const companyInfo = getCompanyInfo();
const systemSettings = getSystemSettings();

// Load storage preferences
const storageTypeInputs = document.querySelectorAll('input[name="storageType"]');
if (systemSettings.storagePreference && systemSettings.storagePreference.type) {
    storageTypeInputs.forEach(inp => inp.checked = inp.value === systemSettings.storagePreference.type);
} else {
    const localRadio = document.querySelector('input[name="storageType"][value="local"]');
    if (localRadio) localRadio.checked = true;
}
const storagePath = document.getElementById('storagePath');
if (storagePath) storagePath.value = systemSettings.storagePreference?.path || '';

// Load company info
document.getElementById('companyName').value = companyInfo.name || 'Swift POS';
document.getElementById('companyAddress').value = companyInfo.address || '';
document.getElementById('companyPhone').value = companyInfo.phone || '';

// Load system settings
document.getElementById('currency').value = systemSettings.currency || 'MMK';
document.getElementById('taxRate').value = systemSettings.taxRate || 0;
document.getElementById('enableNotifications').checked = systemSettings.enableNotifications !== false;
document.getElementById('enableSound').checked = systemSettings.enableSound !== false;
}

// Company form submission
document.getElementById('companyForm').addEventListener('submit', function(e) {
e.preventDefault();

const name = document.getElementById('companyName').value.trim();
const address = document.getElementById('companyAddress').value.trim();
const phone = document.getElementById('companyPhone').value.trim();
const logoFile = document.getElementById('companyLogo').files[0];

if (!name) {
showToast('Company name is required', 'error');
return;
}

const companyInfo = {
name,
address: address || null,
phone: phone || null,
logo: getCompanyInfo().logo || null
};

if (logoFile) {
const reader = new FileReader();
reader.onload = function(e) {
companyInfo.logo = e.target.result;
saveCompanyInfo(companyInfo);
showToast('Company information saved successfully', 'success');
};
reader.readAsDataURL(logoFile);
} else {
saveCompanyInfo(companyInfo);
showToast('Company information saved successfully', 'success');
}
});

// System settings form submission
document.getElementById('systemForm').addEventListener('submit', function(e) {
e.preventDefault();

const currency = document.getElementById('currency').value;
const taxRate = parseFloat(document.getElementById('taxRate').value);
const enableNotifications = document.getElementById('enableNotifications').checked;
const enableSound = document.getElementById('enableSound').checked;

if (isNaN(taxRate) || taxRate < 0 || taxRate > 100) {
showToast('Tax rate must be between 0 and 100', 'error');
return;
}

const existing = getSystemSettings();
const systemSettings = {
 currency,
 taxRate,
 enableNotifications,
 enableSound,
 storagePreference: existing.storagePreference || { type: 'local', path: '' }
};

saveSystemSettings(systemSettings);
showToast('System settings saved successfully', 'success');
});

// Data management
document.getElementById('exportDataButton').addEventListener('click', function() {
const data = {
products: getProducts(),
sales: getSales(),
suppliers: getSuppliers(),
expenses: getExpenses(),
customers: getCustomers(),
companyInfo: getCompanyInfo(),
systemSettings: getSystemSettings(),
exportDate: new Date().toISOString()
};

const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data, null, 2));
const downloadAnchorNode = document.createElement('a');
downloadAnchorNode.setAttribute('href', dataStr);
downloadAnchorNode.setAttribute('download', 'swift-pos-backup.json');
document.body.appendChild(downloadAnchorNode);
downloadAnchorNode.click();
downloadAnchorNode.remove();

showToast('Data exported successfully', 'success');
});

document.getElementById('importDataButton').addEventListener('click', function() {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.json';
input.onchange = function(e) {
const file = e.target.files[0];
if (!file) return;

const reader = new FileReader();
reader.onload = function(e) {
try {
const data = JSON.parse(e.target.result);

if (confirm('This will replace all current data. Are you sure?')) {
if (data.products) saveProducts(data.products);
if (data.sales) saveSales(data.sales);
if (data.suppliers) saveSuppliers(data.suppliers);
if (data.expenses) saveExpenses(data.expenses);
if (data.customers) saveCustomers(data.customers);
if (data.companyInfo) saveCompanyInfo(data.companyInfo);
if (data.systemSettings) saveSystemSettings(data.systemSettings);

showToast('Data imported successfully', 'success');

// Reload current view
const currentView = Object.keys(views).find(key => !views[key].classList.contains('hidden'));
if (currentView) {
showView(currentView);
}
}
} catch (error) {
showToast('Invalid data file', 'error');
console.error('Import error:', error);
}
};
reader.readAsText(file);
};
input.click();
});

// Storage preferences form submission
document.getElementById('storageForm').addEventListener('submit', function(e) {
e.preventDefault();
const selectedType = (document.querySelector('input[name="storageType"]:checked') || {}).value || 'local';
const path = document.getElementById('storagePath').value.trim();
const settings = getSystemSettings();
settings.storagePreference = { type: selectedType, path };
saveSystemSettings(settings);
showToast('Storage preference saved', 'success');
});

// Choose local folder (limited support in browsers; uses directory file input as a fallback)
const pickBtn = document.getElementById('pickLocalFolderButton');
if (pickBtn) {
pickBtn.addEventListener('click', function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.webkitdirectory = true;
    input.directory = true;
    input.onchange = function(e) {
        const files = Array.from(e.target.files || []);
        if (files.length > 0) {
            // Derive a pseudo-folder path from first file
            const first = files[0];
            const pathGuess = (first.webkitRelativePath || '').split('/').slice(0, -1).join('/');
            const current = getSystemSettings();
            current.storagePreference = { type: 'local', path: pathGuess };
            saveSystemSettings(current);
            const storagePathEl = document.getElementById('storagePath');
            if (storagePathEl) storagePathEl.value = pathGuess;
            const localRadio = document.querySelector('input[name="storageType"][value="local"]');
            if (localRadio) localRadio.checked = true;
            showToast('Folder selected', 'success');
        }
    };
    input.click();
});
}

document.getElementById('resetDataButton').addEventListener('click', function() {
if (confirm('This will delete all data and cannot be undone. Are you sure?')) {
localStorage.clear();
initializeData();
showToast('Data reset successfully', 'success');
showView('dashboard');
}
});

// ===========================
// EVENT LISTENERS
// ===========================

// Tab navigation
Object.entries(tabButtons).forEach(([viewName, button]) => {
button.addEventListener('click', () => showView(viewName));
});

// Mobile navigation
mobileNavSelect.addEventListener('change', function() {
showView(this.value);
});

// Mobile menu
mobileMenuButton.addEventListener('click', function() {
sidebar.classList.add('open');
overlay.classList.add('open');
});

closeSidebar.addEventListener('click', function() {
sidebar.classList.remove('open');
overlay.classList.remove('open');
});

overlay.addEventListener('click', function() {
sidebar.classList.remove('open');
this.classList.remove('open');
});

// Mobile sidebar navigation
document.getElementById('mobileDashboardTab').addEventListener('click', () => showView('dashboard'));
document.getElementById('mobileProductsTab').addEventListener('click', () => showView('products'));
document.getElementById('mobileSalesTab').addEventListener('click', () => showView('sales'));
document.getElementById('mobileSuppliersTab').addEventListener('click', () => showView('suppliers'));
document.getElementById('mobileExpensesTab').addEventListener('click', () => showView('expenses'));
document.getElementById('mobileCustomersTab').addEventListener('click', () => showView('customers'));
document.getElementById('mobileReportsTab').addEventListener('click', () => showView('reports'));
document.getElementById('mobileSettingsTab').addEventListener('click', () => showView('settings'));

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
initializeData();
showView('dashboard');

// Set current date for expense form
document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];

// Set default dates for reports (current month)
const today = new Date();
const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);

document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
document.getElementById('endDate').value = lastDay.toISOString().split('T')[0];

// Check online/offline status
window.addEventListener('online', function() {
document.getElementById('offlineIndicator').classList.add('hidden');
showToast('Connection restored', 'success');
});

window.addEventListener('offline', function() {
document.getElementById('offlineIndicator').classList.remove('hidden');
showToast('You are currently offline', 'warning');
});

// Initialize offline indicator
if (!navigator.onLine) {
document.getElementById('offlineIndicator').classList.remove('hidden');
}
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
// Ctrl/Cmd + number shortcuts for tabs
if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '8') {
const tabIndex = parseInt(e.key) - 1;
const tabNames = ['dashboard', 'products', 'sales', 'suppliers', 'expenses', 'customers', 'reports', 'settings'];
if (tabIndex < tabNames.length) {
e.preventDefault();
showView(tabNames[tabIndex]);
}
}

// Escape key to close mobile menu
if (e.key === 'Escape') {
sidebar.classList.remove('open');
overlay.classList.remove('open');
}
});
</script>
</body>
</html>
